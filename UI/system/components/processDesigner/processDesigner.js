var SVG_NS="http://www.w3.org/2000/svg";if(typeof(justep)=="undefined"){justep={}}justep.se35={};justep.se35.av42=function(a){if(!a){return}for(var b in a){this[b]=a[b]}};justep.se35.av42.prototype={mo51:function(e,c){this.cb26=document.createElementNS(SVG_NS,e);var d=c.split(";");for(var b=0;b<d.length;b++){var a=d[b];if(a.indexOf(":")!=-1){a=a.split(":");this.cb26.setAttribute(a[0],a[1])}}this.parent.appendChild(this.cb26);this.cb26.xg36=this;this.xt52(this.shape);this.setText(this.text)},xt52:function(a){this.shape=a;this.cb26.setAttribute("width",a.w);this.cb26.setAttribute("height",a.h);this.cb26.setAttribute("x",a.x);this.cb26.setAttribute("y",a.y);this.go61();return this},ih53:function(a){this.cb26.setAttribute("stroke",a.color);this.cb26.setAttribute("stroke-width",a.weight)},uc54:function(a){if(typeof a=="string"){this.cb26.setAttribute("fill",a);return}if(a.color!==undefined){this.cb26.setAttribute("fill",a.color)}if(a.opacity!==undefined){this.cb26.setAttribute("opacity",a.opacity)}return this},xf55:function(){this.cb26.parentNode.appendChild(this.cb26);return this},vn56:function(){return this.shape},up57:function(){if(this.cb26){return this.shape}},setText:function(a){this.text=a||"";this.text=this.text.replace(/@br@/gm,"");if(this.cb26){if(!this.ax33){this.textColor=this.textColor?this.textColor:"black";this.ax33=document.createElementNS(SVG_NS,"text");this.ax33.setAttribute("style","font-size:13px;fill: "+this.textColor+";");this.ax33.xg36=this.cb26.xg36;this.parent.appendChild(this.ax33)}while(this.ax33.firstChild){this.ax33.removeChild(this.ax33.firstChild)}if(a!=""){this.ax33.appendChild(document.createTextNode(this.text));this.go61()}}},uc58:function(){return this.text.replace(/<br\/>/gm,"@br@")},cl59:function(b){var a=b?"":"none";this.cb26.style.display=a;if(this.ax33){this.ax33.style.display=a}},qb60:function(a){this.textColor=a;if(this.ax33){this.ax33.setAttribute("style","fill: "+a+";")}},go61:function(){if(this.ax33){var c=this.up57();var d=this.cm62();var a=d.w;var b=d.h;this.ax33.setAttribute("x",(c.x+(c.w-a)/2));this.ax33.setAttribute("y",(c.y+(c.h)/2)+3)}},cm62:function(){var c=document.createElement("span");c.style.position="absolute";c.style.top="-100px";c.style.fontSize="13px";document.body.appendChild(c);c.innerHTML=this.text;var a=c.offsetWidth;var b=c.offsetHeight;document.body.removeChild(c);return{w:a,h:b}},do63:function(){this.parent.removeChild(this.cb26);if(this.ax33){this.parent.removeChild(this.ax33)}}};justep.se35.lp39=function(a){justep.se35.av42.call(this,a);this.mo51("rect","fill:#ffffff;stroke-width:1;stroke:#000000;");this.cb26.setAttribute("rx",5)};justep.se35.lp39.prototype=new justep.se35.av42();justep.se35.xu5=function(a){justep.se35.av42.call(this,a);this.mo51("polyline","fill:#ffffff;stroke-width:1;stroke:#000000;")};justep.se35.xu5.prototype=new justep.se35.av42();justep.se35.xu5.prototype.xt52=function(b){this.shape=b;var c=b.x;var a=b.x+b.w;var e=b.y;var d=b.y+b.h;this.cb26.setAttribute("points",[c,e,a,e,(a+c)/2,d,c,e].join(" "));this.go61()};justep.se35.nf23=function(a){justep.se35.av42.call(this,a);this.mo51("polyline","fill:#ffffff;stroke-width:1;stroke:#000000;")};justep.se35.nf23.prototype=new justep.se35.av42();justep.se35.nf23.prototype.xt52=function(b){this.shape=b;var c=b.x;var a=b.x+b.w;var e=b.y;var d=b.y+b.h;this.cb26.setAttribute("points",[c,(e+d)/2,(c+a)/2,e,a,(e+d)/2,(c+a)/2,d,c,(e+d)/2].join(" "));this.go61()};justep.se35.at49=function(a){justep.se35.av42.call(this,a);this.mo51("circle","fill:#ffffff;stroke-width:1;stroke:#000000;")};justep.se35.at49.prototype=new justep.se35.av42();justep.se35.at49.prototype.xt52=function(a){this.shape=a;this.cb26.setAttribute("cx",a.x+a.w/2);this.cb26.setAttribute("cy",a.y+a.h/2);this.cb26.setAttribute("r",a.w<a.h?a.w/2:a.h/2);this.go61()};justep.se35.sb24=function(a){justep.se35.av42.call(this,a);this.mo51("polyline","fill:#ffffff;stroke-width:1;stroke:#000000;")};justep.se35.sb24.prototype=new justep.se35.av42();justep.se35.sb24.prototype.xt52=function(b){this.shape=b;var c=b.x;var a=b.x+b.w;var e=b.y;var d=b.y+b.h;this.cb26.setAttribute("points",[c,e,a,e,(a-b.w/4),d,(c+b.w/4),d,c,e].join(" "));this.go61()};justep.se35.ud18=function(a){justep.se35.av42.call(this,a);this.mo51("path","fill-opacity:0;stroke-width:1;stroke:#000000;")};justep.se35.ud18.prototype=new justep.se35.av42();justep.se35.ud18.prototype.xt52=function(e){this.shape=e;var m=["M"];for(var d=0,b=e.length;d<b;d++){var h=parseInt(e[d].x,10),f=parseInt(e[d].y,10);if(d==0){m.push(h+","+f)}else{m.push("L");m.push(h+","+f)}if(e[d].attach){var g=e[d].attach;var a=g.split(" ");for(var c=0;c<a.length/8;c++){m.push("L");m.push(parseInt(a[0+c*8].replace("L",""),10)+","+parseInt(a[1+c*8],10));m.push("C");m.push(parseInt(a[2+c*8].replace("C",""),10)+","+parseInt(a[3+c*8],10));m.push(parseInt(a[4+c*8],10)+","+parseInt(a[5+c*8],10));m.push(parseInt(a[6+c*8],10)+","+parseInt(a[7+c*8],10))}}}this.cb26.setAttribute("d",m.join(" "));this.fp65(this.endArrow);this.go61();var k=this};justep.se35.ud18.prototype.up57=function(){var b=9999,g=9999,a=0,f=0;for(var e=0;e<this.shape.length;e++){var h=this.shape[e];b=Math.min(b,h.x);g=Math.min(g,h.y);a=Math.max(a,h.x);f=Math.max(f,h.y);if(h.attach){var c=h.attach.split(" ");for(var d=0;d<c.length;d++){var k=parseInt(c[d].replace("C",""));if(d%2==0){b=Math.min(b,k);a=Math.max(a,k)}else{g=Math.min(g,k);f=Math.max(f,k)}}}}return{x:b,y:g,w:a-b,h:f-g}};justep.se35.ud18.prototype.go61=function(){if(this.ax33){var c=this.shape[0].x;var g=this.shape[0].y;var b=this.shape[1].x;var e=this.shape[1].y;var d=this.cm62();var a=d.w;var f=d.h;this.ax33.setAttribute("x",(c+b-a)/2);this.ax33.setAttribute("y",(g+e)/2)}};justep.se35.ud18.prototype.wf64=function(){if(!this.endArrow){var a=document.createElementNS(SVG_NS,"path");this.parent.appendChild(a);this.endArrow=a;this.fp65(a)}};justep.se35.ud18.prototype.fp65=function(e){if(!e){return}var b=this.shape.length;var a=this.shape[b-1].x;var g=this.shape[b-1].y;var c=this.shape[b-2].x;var d=this.shape[b-2].y;var f=a==c?(d>g?"up":"down"):(c>a?"left":"right");if(f=="left"){e.setAttribute("d","M"+a+" "+g+" L"+(a+10)+" "+(g-3)+" L"+(a+10)+" "+(g+3)+" Z")}else{if(f=="right"){e.setAttribute("d","M"+a+" "+g+" L"+(a-10)+" "+(g-3)+" L"+(a-10)+" "+(g+3)+" Z")}else{if(f=="up"){e.setAttribute("d","M"+a+" "+g+" L"+(a-3)+" "+(g+10)+" L"+(a+3)+" "+(g+10)+" Z")}else{if(f=="down"){e.setAttribute("d","M"+a+" "+g+" L"+(a-3)+" "+(g-10)+" L"+(a+3)+" "+(g-10)+" Z")}}}}};justep.se35.ud18.prototype.ih53=function(a){this.cb26.setAttribute("stroke",a.color);this.cb26.setAttribute("stroke-width",a.weight);if(this.endArrow){this.endArrow.setAttribute("fill",a.color);this.endArrow.setAttribute("stroke",a.color);this.endArrow.setAttribute("stroke-width",a.weight)}};justep.se35.ud18.prototype.do63=function(a){this.parent.removeChild(this.cb26);if(this.ax33){this.parent.removeChild(this.ax33)}if(this.endArrow){this.parent.removeChild(this.endArrow)}};var XLINK_NS="http://www.w3.org/1999/xlink";if(typeof(justep)=="undefined"){justep={}}justep.wq28={};justep.wq28.av42=function(a){if(!a){return}for(var b in a){this[b]=a[b]}};justep.wq28.av42.prototype={ql27:"Behavior: url(#default#VML);position:absolute;width:100;height:100;",al66:function(f,c,d,b){var a=[];var h;if($.browser.version=="7.0"||$.browser.version=="6.0"){for(var g in b){a.push(g+"='"+b[g]+"'")}h=document.createElement("<"+c+" "+a.join(" ")+" style='"+d+"'></"+c+">")}else{h=document.createElement(c);if(d){h.style.cssText=d}if(b){for(var g in b){h.setAttribute(g,b[g])}}}if(f){f.appendChild(h)}return h},mo51:function(b,c,a){this.cb26=this.al66(this.parent,b,c,a);this.cb26.xg36=this;this.xt52(this.shape);this.setText(this.text)},xt52:function(b){if(!b){return}this.shape=b;var a=$(this.cb26);a.css({top:b.y+"px",left:b.x+"px",width:b.w+"px",height:b.h+"px"});if(a.width()>0){a.width(b.w-(a.width()-b.w));a.height(b.h-(a.height()-b.h))}this.go61()},hw67:function(){return{color:this.cb26.strokeColor,weight:this.cb26.StrokeWeight}},ih53:function(a){if($.browser.version=="9.0"){this.cb26.setAttribute("strokeColor",a.color)}this.cb26.strokeColor=a.color||"";this.cb26.StrokeWeight=a.weight||"1px";this.cb26.stroked=(a.weight==0||a.weight=="0")?"f":"t"},uc54:function(a){if(typeof(a)=="string"){this.cb26.fillcolor=a||"white"}else{this.cb26.fillcolor=a.color||"green";this.cb26.style.filter="alpha(opacity="+(a.opacity*100)||100+")"}},xf55:function(){this.cb26.parentNode.appendChild(this.cb26);return this},vn56:function(){return this.shape},up57:function(){if(this.cb26){var a=$(this.cb26);var b=a.position();return{x:b.left,y:b.top,w:a.outerWidth(),h:a.outerHeight()}}},setText:function(a){this.text=a||"";this.text=this.text.replace(/@br@/gm,"<br/>");if(this.cb26){if(!this.ax33){this.ax33=document.createElement("span");this.textColor=this.textColor?this.textColor:"black";$(this.ax33).css({cursor:"default",overflow:"auto",position:"absolute",font:"normal 12px 宋体, 'Arial Narrow', arial, serif",color:this.textColor});this.parent.appendChild(this.ax33);this.ax33.xg36=this.cb26.xg36}this.ax33.innerHTML=this.text;this.go61()}},cl59:function(b){var a=b?"":"none";this.cb26.style.display=a;if(this.ax33){this.ax33.style.display=a}},uc58:function(){return this.text.replace(/<br\/>/gm,"@br@")},qb60:function(a){this.textColor=a;if(this.ax33){$(this.ax33).css({color:a})}},go61:function(){if(this.ax33){var c=this.vn56();var d=this.cm62();var a=d.w;var b=d.h;this.ax33.style.width=(a+1)+"px";this.ax33.style.left=(c.x+(c.w-a)/2)+"px";this.ax33.style.top=(c.y+(c.h-b)/2)+"px"}},cm62:function(){var c=document.createElement("span");c.style.position="absolute";c.style.top="-100px";c.style.font="normal 12px 宋体, 'Arial Narrow', arial, serif";document.body.appendChild(c);c.innerHTML=this.text;var a=c.offsetWidth;var b=c.offsetHeight;document.body.removeChild(c);return{w:a,h:b}},do63:function(){if(this.ax33){this.ax33.xg36=null}this.parent.removeChild(this.cb26);if(this.ax33){this.parent.removeChild(this.ax33)}for(var a in this){this[a]=null}}};justep.wq28.lp39=function(a){justep.wq28.av42.call(this,a);this.mo51("v:RoundRect",this.ql27)};justep.wq28.lp39.prototype=new justep.wq28.av42();justep.wq28.xu5=function(a){justep.wq28.av42.call(this,a);this.mo51("v:shape",this.ql27,{coordsize:"100 100",path:"m 0,0 l 100,0,50,100,0,0 x e"})};justep.wq28.xu5.prototype=new justep.wq28.av42();justep.wq28.nf23=function(a){justep.wq28.av42.call(this,a);this.mo51("v:shape",this.ql27,{coordsize:"100 100",path:"m 0,50 l 50,0,100,50,50,100,0,50 x e"})};justep.wq28.nf23.prototype=new justep.wq28.av42();justep.wq28.at49=function(a){justep.wq28.av42.call(this,a);this.mo51("v:oval",this.ql27)};justep.wq28.at49.prototype=new justep.wq28.av42();justep.wq28.sb24=function(a){justep.wq28.av42.call(this,a);this.mo51("v:shape",this.ql27,{coordsize:"100 100",path:"m 0,0 l 100,0,75,100,25,100,0,0 x e"})};justep.wq28.sb24.prototype=new justep.wq28.av42();justep.wq28.ud18=function(a){justep.wq28.av42.call(this,a);this.mo51("v:shape",this.ql27+";display:inline-block;width:1px;height:1px;",{filled:"false",path:"m 0,0,0,0 x e",coordsize:"1 1"});this.xq37=document.createElement("v:stroke");this.xq37.style.cssText="BEHAVIOR: url(#default#VML);DISPLAY: inline-block;";this.cb26.appendChild(this.xq37)};justep.wq28.ud18.prototype=new justep.wq28.av42();justep.wq28.ud18.prototype.xt52=function(e){this.shape=e;var m=["M"];for(var d=0,b=e.length;d<b;d++){var h=parseInt(e[d].x,10),f=parseInt(e[d].y,10);if(d==0){m.push(h);m.push(f)}else{m.push("L");m.push(h);m.push(f)}if(e[d].attach){var g=e[d].attach;var a=g.split(" ");for(var c=0;c<a.length/8;c++){m.push("L");m.push(parseInt(a[0+c*8].replace("L",""),10)+","+parseInt(a[1+c*8],10));m.push("C");m.push(parseInt(a[2+c*8].replace("C",""),10)+","+parseInt(a[3+c*8],10));m.push(parseInt(a[4+c*8],10)+","+parseInt(a[5+c*8],10));m.push(parseInt(a[6+c*8],10)+","+parseInt(a[7+c*8],10))}}}if($.browser.version=="9.0"){var k=this;setTimeout(function(){k.cb26.path=m.join(" ");k.go61()},1)}else{this.cb26.path=m.join(" ");this.go61()}};justep.wq28.ud18.prototype.go61=function(){if(this.ax33&&this.shape.length>1){var c=this.shape[0].x;var g=this.shape[0].y;var b=this.shape[1].x;var e=this.shape[1].y;var d=this.cm62();var a=d.w;var f=d.h;this.ax33.style.left=(c+b-a)/2+"px";this.ax33.style.top=(g+e-f)/2+"px"}};justep.wq28.ud18.prototype.wf64=function(){if(!this.endArrow){this.xq37.setAttribute("EndArrow","Classic");this.xq37.EndArrow="Classic";this.endArrow=true}};justep.wq28.ud18.prototype.nz68=function(){if(!this.StartArrow){this.xq37.setAttribute("StartArrow","Classic");this.xq37.StartArrow="Classic";this.startArrow=true}};justep.wq28.ud18.prototype.ab69=function(){if(this.endArrow){this.xq37.setAttribute("EndArrow",undefined);this.xq37.EndArrow=undefined;this.endArrow=false}};justep.wq28.ud18.prototype.ao70=function(){if(this.startArrow){this.xq37.setAttribute("StartArrow",undefined);this.xq37.StartArrow=undefined;this.startArrow=false}};$.fn.extend({setCapture:function(a){if(a.setCapture){a.setCapture()}else{if(window.captureEvents){window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP)}}},releaseCapture:function(a){if(a.releaseCapture){a.releaseCapture()}else{if(window.captureEvents){window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP)}}}});(function(b){function a(c,d){return this.each(function(){if(typeof d!="string"){return}if(!jQuery.isXMLDoc(this)){return}var e=b.parseXml(d).firstChild.cloneNode(true);switch(c){case"append":this.appendChild(e);break;case"prepend":if(this.childNodes.length>0){this.insertBefore(e,this.firstChild)}else{this.appendChild(e)}break;case"after":if(this.nextSibling){this.parentNode.insertBefore(e,this.nextSibling)}else{this.parentNode.appendChild(e)}break;case"before":this.parentNode.insertBefore(e,this);break}})}b.fn.extend({appendXml:function(c){return a.call(this,"append",c)},prependXml:function(c){return a.call(this,"prepend",c)},afterXml:function(c){return a.call(this,"after",c)},beforeXml:function(c){return a.call(this,"before",c)},xml:function(){var c=this[0];return c.xml||(new XMLSerializer()).serializeToString(c)},innerXml:function(){var e=this.xml();var d=e.indexOf(">"),c=e.lastIndexOf("<");if(c>d){return e.substring(d+1,c)}else{return""}}});b.extend(jQuery,{parseXml:function(d){if(window.ActiveXObject){var c=new ActiveXObject("Microsoft.XMLDOM");c.async=false;c.loadXML(d);return c}else{if(typeof DOMParser!="undefined"&&!!d){var c=new DOMParser().parseFromString(d,"text/xml");return c}else{return null}}},toXml:function(f,h,d){var c=b(b.parseXml("<"+h+" />"));var g=c.find(":first");for(var e in f){if(d){g.attr(e,f[e])}else{g.appendXml("<"+e+" />").find(e).text(f[e])}}return c[0]}})})(jQuery);var console;var idx=0;var msgBuf=[];gf71=function(a){if(!console){console=document.getElementById("console")}msgBuf.splice(0,0,a+"  ["+(idx++)+"]\n");console.value=msgBuf.join(" ");$("#console").val(msgBuf.join(" "));if(idx%50==0){msgBuf.splice(idx-1,1)}};String.prototype.sn72=function(b,a){return this.replace(new RegExp(b,"gm"),a)};justep.graphics={};justep.process={};justep.it45={UP:"n",RIGHT:"e",DOWN:"s",LEFT:"w"};justep.graphics.ir41=function(){this.dx38=30;this.points=[]};justep.graphics.ir41.prototype={cc73:function(c,a,d,f,e){var b=c.vn56();a=a||b[0];d=d||c.outPort.direction;f=f||b[b.length-1];e=e||c.inPort.direction;this.points=[];this.sd77(c,f,e,a,d);return this.points},ok74:function(b){for(var a=0;a<b.length-1;a++){if(!this.re75(b[a],b[a+1])){return false}}return true},re75:function(b,a){if(Math.abs(b.x-a.x)<0.5||Math.abs(b.y-a.y)<0.5){return true}return false},ad76:function(a,b){return{x:a,y:b}},sd77:function(d,e,h,p,c){var g=0.1;var f=0.01;var o="n";var i="e";var m="s";var a="w";var l=e.x-p.x;var j=e.y-p.y;var n;var b;if(((l*l)<(f))&&((j*j)<(f))){this.points.push(this.ad76(p.x,p.y));return}if(h==a){if((l>0)&&((j*j)<g)&&(c==i)){n=p;b=c}else{if(l<0){n=this.ad76(e.x-this.dx38,e.y)}else{if(((j>0)&&(c==m))||((j<0)&&(c==o))){n=this.ad76(p.x,e.y)}else{if(h==c){var k=Math.min(e.x,p.x)-this.dx38;n=this.ad76(k,e.y)}else{n=this.ad76(e.x-(l/2),e.y)}}}if(j>0){b=o}else{b=m}}}else{if(h==i){if((l<0)&&((j*j)<g)&&(c==a)){n=p;b=c}else{if(l>0){n=this.ad76(e.x+this.dx38,e.y)}else{if(((j>0)&&(c==m))||((j<0)&&(c==o))){n=this.ad76(p.x,e.y)}else{if(h==c){var k=Math.max(e.x,p.x)+this.dx38;n=this.ad76(k,e.y)}else{n=this.ad76(e.x-(l/2),e.y)}}}if(j>0){b=o}else{b=m}}}else{if(h==m){if(((l*l)<g)&&(j<0)&&(c==o)){n=p;b=c}else{if(j>0){n=this.ad76(e.x,e.y+this.dx38)}else{if(((l>0)&&(c==i))||((l<0)&&(c==a))){n=this.ad76(e.x,p.y)}else{if(h==c){var k=Math.max(e.y,p.y)+this.dx38;n=this.ad76(e.x,k)}else{n=this.ad76(e.x,e.y-(j/2))}}}if(l>0){b=a}else{b=i}}}else{if(h==o){if(((l*l)<g)&&(j>0)&&(c==m)){n=p;b=c}else{if(j<0){n=this.ad76(e.x,e.y-this.dx38)}else{if(((l>0)&&(c==i))||((l<0)&&(c==a))){n=this.ad76(e.x,p.y)}else{if(h==c){var k=Math.min(e.y,p.y)-this.dx38;n=this.ad76(e.x,k)}else{n=this.ad76(e.x,e.y-(j/2))}}}if(l>0){b=a}else{b=i}}}}}}this.sd77(d,n,b,p,c);this.points.push(e)}};justep.graphics.bz2={containInLine:function(a,h,b){var e=this.distance({x:b[0].x,y:b[0].y},{x:a,y:h});var c=this.distance({x:b[1].x,y:b[1].y},{x:a,y:h});var g=this.distance({x:b[1].x,y:b[1].y},{x:b[0].x,y:b[0].y});var f=Math.abs(g-e-c);if(f<=3){return true}else{return false}},containInRect:function(a,c,b){if(a>=b.x&&a<=b.x+b.w&&c>=b.y&&c<=b.y+b.h){return true}},distance:function(f,d){var e=f.x-d.x;var c=f.y-d.y;return Math.sqrt(e*e+c*c)},manhattanRoute:function(b,a,c,e,d){if(!this.zm30){this.zm30=new justep.graphics.ir41()}return this.zm30.cc73(b,a,c,e,d)}};justep.graphics.Port=function(a){this.as25={};for(var b in a){this[b]=a[b]}this.shape=this.shape||{x:0,y:0,w:12,h:12}};justep.graphics.Port.prototype={qp78:function(){if(!this.figure){this.figure=new justep[this.figureType].at49({parent:this.parent,shape:this.shape});this.figure.uc54("green");this.figure.cl59(false)}},cl59:function(a){this.visible=a;this.qp78();if(!a){this.hd83(false)}this.figure.cl59(a)},pd79:function(b,a){this.as25[b.id]=b},zi80:function(){for(var a in this.as25){return true}return false},removeConnection:function(a){var b=a.id;this.as25[b]=null;delete this.as25[b]},no81:function(){if(this.as25){for(var b in this.as25){var a=this.as25[b];if(a.inPort==this){return"inPort"}else{if(a.outPort==this){return"outPort"}}}}return this.portType},tn82:function(){var a=this.vn56();return{x:a.x+a.w/2,y:a.y+a.h/2}},hd83:function(b){this.qp78();if(this.figureType!="wq28"){return}if(b&&!this.co21){this.co21=this.figure.al66(this.parent,"v:oval","z-index:1000;Behavior: url(#default#VML);position:absolute;width:19px;height:19px;",{filled:"t",fillcolor:"#f57bff",stroked:"f"});if($.browser.version=="7.0"||$.browser.version=="8.0"){this.co21.fill.opacity=0.5}else{var a=this.figure.al66(this.co21,"v:fill","",{opacity:"0.5"});this.co21.appendChild(a)}var d=this.tn82();this.co21.style.top=(d.y-11)+"px";this.co21.style.left=(d.x-11)+"px"}else{if(!b&&this.co21){this.parent.removeChild(this.co21);this.co21=null}}},gj84:function(c,a){var a=a||this.tn82();var j=c.vn56();var m=0;if(this.no81()=="inPort"){m=j.length-1}var o=a.x-j[m].x;var n=a.y-j[m].y;if(c.inPort&&c.outPort){var g=c.outPort.tn82();var e=c.inPort.tn82();j[0].x=g.x;j[0].y=g.y;j[j.length-1].x=e.x;j[j.length-1].y=e.y;var h=false;for(var f=0,d=j.length;f<d;f++){if(j[f].cusMove){h=true;break}}if(!h){j=justep.graphics.bz2.manhattanRoute(c)}else{var b=-1;var k=c.inPort.direction;if(m==j.length-1){b=m-1}else{b=m+1;k=c.outPort.direction}switch(k){case justep.it45.UP:case justep.it45.DOWN:j[b].x+=o;break;case justep.it45.LEFT:case justep.it45.RIGHT:j[b].y+=n}}}for(var f=0,d=j.length;f<d;f++){if(j[f].x<0){j[f].x=1}if(j[f].y<0){j[f].y=1}}c.xt52(j)},up57:function(){this.qp78();if(this.figureType=="wq28"){var a=this.figure.cb26.style.left;var d=this.figure.cb26.style.top;var b=$(this.figure.cb26);var c=b.position();return{x:(a?parseInt(a):c.left),y:(d?parseInt(d):c.top),w:this.w,h:this.h}}else{return this.figure.up57()}},vn56:function(){return this.shape},xt52:function(a){this.shape=a;if(this.figure){this.figure.xt52(a)}else{if(this.visible){this.qp78()}}},vb85:function(){if(this.calcuPosition){var g=this.calcuPosition.call(this);var e=this.vn56();e.x=g.x-3;e.y=g.y-3;this.xt52(e);var a=this.tn82();for(var d in this.as25){var b=this.as25[d];this.gj84(b)}if(this.co21){var f=this.tn82();this.co21.style.top=(f.y-6)+"px";this.co21.style.left=(f.x-6)+"px"}}},do63:function(){if(this.co21){this.co21.parentNode.removeChild(this.co21);this.co21=null}if(this.figure){this.figure.do63()}this.figure=null}};justep.wq28.Port=function(a){this.as25={};justep.wq28.av42.call(this,a);this.w=12;this.h=12;this.cb26=this.al66(this.parent,"v:oval","display:none;z-index:1000;Behavior: url(#default#VML);position:absolute;width:"+this.w+"px;height:"+this.h+"px",{fillcolor:"green",stroked:"f"});this.parent.appendChild(this.cb26)};justep.wq28.Port.prototype=new justep.wq28.av42();justep.wq28.Port.prototype.cl59=function(a){this.cb26.style.display=a?"":"none"};justep.wq28.Port.prototype.pd79=function(b,a){this.as25[b.id]=b};justep.wq28.Port.prototype.no81=function(){if(this.as25){for(var b in this.as25){var a=this.as25[b];if(a.inPort==this){return"inPort"}else{if(a.outPort==this){return"outPort"}}}}return this.portType};justep.wq28.Port.prototype.removeConnection=function(a){var b=a.id;this.as25[b]=null;delete this.as25[b]};justep.wq28.Port.prototype.tn82=function(){var a=this.vn56();return{x:a.x+a.w/2,y:a.y+a.h/2}};justep.wq28.Port.prototype.cl59=function(a){if(!a){this.hd83(false)}this.cb26.style.display=a?"block":"none"};justep.wq28.Port.prototype.hd83=function(b){if(b&&!this.co21){this.co21=this.al66(this.parent,"v:oval","z-index:1000;Behavior: url(#default#VML);position:absolute;width:19px;height:19px;",{filled:"t",fillcolor:"#f57bff",stroked:"f"});var a=this.al66(this.co21,"v:fill","",{opacity:".5"});this.co21.appendChild(a);var d=this.tn82();this.co21.style.top=(d.y-9)+"px";this.co21.style.left=(d.x-9)+"px"}else{if(!b&&this.co21){this.parent.removeChild(this.co21);this.co21=null}}};justep.wq28.Port.prototype.gj84=function(c,a){var a=a||this.tn82();var j=c.vn56();var m=0;if(this.no81()=="inPort"){m=j.length-1}var o=a.x-j[m].x;var n=a.y-j[m].y;if(c.inPort&&c.outPort){var g=c.outPort.tn82();var e=c.inPort.tn82();j[0].x=g.x;j[0].y=g.y;j[j.length-1].x=e.x;j[j.length-1].y=e.y;var h=false;for(var f=0,d=j.length;f<d;f++){if(j[f].cusMove){h=true;break}}if(!h){j=justep.graphics.bz2.manhattanRoute(c)}else{var b=-1;var k=c.inPort.direction;if(m==j.length-1){b=m-1}else{b=m+1;k=c.outPort.direction}switch(k){case justep.it45.UP:case justep.it45.DOWN:j[b].x+=o;break;case justep.it45.LEFT:case justep.it45.RIGHT:j[b].y+=n}}}for(var f=0,d=j.length;f<d;f++){if(j[f].x<0){j[f].x=1}if(j[f].y<0){j[f].y=1}}c.xt52(j)};justep.wq28.Port.prototype.up57=function(){var a=this.cb26.style.left;var d=this.cb26.style.top;var b=$(this.cb26);var c=b.position();return{x:(a?parseInt(a):c.left),y:(d?parseInt(d):c.top),w:this.w,h:this.h}};justep.wq28.Port.prototype.vb85=function(){if(this.calcuPosition){var f=this.calcuPosition.call(this);this.xt52({x:f.x-3,y:f.y-3,w:this.w,h:this.h});var a=this.tn82();for(var d in this.as25){var b=this.as25[d];this.gj84(b)}if(this.co21){var e=this.tn82();this.co21.style.top=(e.y-6)+"px";this.co21.style.left=(e.x-6)+"px"}}};justep.wq28.Port.prototype.do63=function(){if(this.co21){this.co21.parentNode.removeChild(this.co21);this.co21=null}justep.wq28.av42.prototype.do63.call(this)};justep.graphics.ProcessRect=function(e,q){this.modelData=q;this.pc1=e;this.figureType=e.figureType;this.id=q.id;var j=this.type=q.type;var f=q.style||{};if(f.bound){f.shape=f.bound;f.bound=null;delete f.bound}f.parent=e.lv29;var n,g=106,c=34,l=44;var m,d,b;var o=e.us116(j);if(!this.pc1.version){var h=f.shape;if(h){if(h.w){}if(h.h){}}}switch(j){case"start":n=[["inPort","e"],["outPort","s"],["inPort","w"]];g=l;c=l;m="开始";b="place";break;case"conditionActivity":n=[["inPort","n"],["outPort","s"]];m="条件环节"+o;d="true";b="condition-activity";break;case"businessActivity":n=[["inPort","n"],["","e"],["","s"],["","w"]];m="活动环节"+o;d="true";b="business-activity";break;case"conditionBranch":n=[["inPort","n"],["","e"],["","s"],["","w"]];m="条件分支"+o;c=40;d="true";b="if-else-activity";break;case"and":n=[["inPort","n"],["","e"],["","s"],["","w"]];g=l;c=l;m="AND";b="and-activity";break;case"xor":n=[["inPort","n"],["","e"],["","s"],["","w"]];g=l;c=l;m="XOR";b="place";break;case"autoActivity":n=[["inPort","n"],["","e"],["","s"],["","w"]];m="自动环节"+o;d="true";b="auto-activity";break;case"end":n=[["inPort","n"],["inPort","e"],["inPort","s"],["inPort","w"]];g=l;c=l;m="结束";b="place";break}q.CONDITION=q.CONDITION||d;q.name=q.name||(j+o);q.LABEL=q.LABEL||m;q.tagName=b;if(!q.xmlNode){var k=$.parseXml("<"+b+' name="'+q.name+'" src="'+(q.src||"")+'"><label language="zh_CN"></label></'+b+">");q.xmlNode=k.childNodes[0]}else{q.xmlNode.setAttribute("name",q.name)}if(f.shape){var h=f.shape;h.x=h.x<1?100:h.x;h.y=h.y<1?100:h.y;h.w=h.w||g;h.h=h.h||c}else{f.shape={x:100,y:100,w:g,h:c}}this.figureTypeMap={businessActivity:"lp39",conditionActivity:"xu5",conditionBranch:"nf23",and:"at49",xor:"at49",start:"at49",end:"at49",autoActivity:"sb24"};this.yk13=this.figureTypeMap[j];var a=q.LABEL;var p=f.LABEL;if(p&&p.sn72("@br@","")==a){f.text=p}else{f.text=a}var i=new justep[this.figureType][this.yk13](f);this.wg91(n);this.en47=i;i.cb26.xg36=this;i.ax33.xg36=this;this.ll100();i.ih53({color:"black"})};justep.graphics.ProcessRect.prototype={xd86:function(){return this.en47},vn56:function(){return this.en47.vn56()},kn87:function(){if(this.bs20){return this.bs20}var a=$.extend({},this.vn56());this.bs20=new justep[this.figureType][this.yk13]({parent:this.en47.parent,shape:a});this.bs20.cb26.style.zIndex="2";this.bs20.uc54({color:"blue",opacity:0.4});this.bs20.ih53({color:"blue"});return this.bs20},qa88:function(){return{figureType:this.tq90(),name:this.wt89(),LABEL:this.uc58(),CONDITION:this.modelData.CONDITION}},wt89:function(){return this.modelData.name},tq90:function(){return this.modelData.type},xt52:function(a){this.en47.xt52(a);this.ll100();this.nh97()},up57:function(){return this.en47.up57()},setText:function(a){this.en47.setText(a);this.modelData.label=a},uc58:function(){return this.en47.uc58()},tn82:function(){var a=this.vn56();return{x:a.x+a.w/2,y:a.y+a.h/2}},getBindingConnections:function(){var d=[];for(var b=0,a=this.ports.length;b<a;b++){var f=this.ports[b].as25;for(var e in f){d.push(f[e])}}return d},wg91:function(b){var e=[];for(var c=0,a=b.length;c<a;c++){var d;switch(b[c][1]){case"n":d=function(){var f=this.owner.vn56();return{x:f.x+f.w/2-($.browser.msie?4:3),y:f.y-4}};break;case"e":if(this.type=="conditionBranch"){d=function(){var f=this.owner.vn56();return{x:f.x+f.w-10,y:f.y+f.h/2-($.browser.msie?5:3)}}}else{if(this.type=="autoActivity"){d=function(){var f=this.owner.vn56();return{x:f.x+f.w-19,y:f.y+f.h/2-($.browser.msie?5:3)}}}else{d=function(){var f=this.owner.vn56();return{x:f.x+f.w-4,y:f.y+f.h/2-($.browser.msie?5:3)}}}}break;case"s":if(this.type=="conditionBranch"){d=function(){var f=this.owner.vn56();return{x:f.x+f.w/2-($.browser.msie?4:3),y:f.y+f.h-($.browser.msie?6:4)}}}else{d=function(){var f=this.owner.vn56();return{x:f.x+f.w/2-($.browser.msie?4:3),y:f.y+f.h-4}}}break;case"w":if(this.type=="conditionBranch"){d=function(){var f=this.owner.vn56();return{x:f.x-3,y:f.y+f.h/2-($.browser.msie?5:3)}}}else{if(this.type=="autoActivity"){d=function(){var f=this.owner.vn56();return{x:f.x+8,y:f.y+f.h/2-($.browser.msie?5:3)}}}else{d=function(){var f=this.owner.vn56();return{x:f.x-4,y:f.y+f.h/2-($.browser.msie?5:3)}}}}}e.push(new justep.graphics.Port({figureType:this.figureType,direction:b[c][1],parent:this.pc1.lv29,owner:this,portType:b[c][0],calcuPosition:d}));this.ports=e}},ca92:function(a,d){a=a=="inPort"?"outPort":"Inport";var c=null;for(var e=0,b=this.ports.length;e<b;e++){if(this.ports[e].no81()!=a){c=this.ports[e];if(d){if(this.ports[e].direction==d){return this.ports[e]}}else{return this.ports[e]}}}return c},bb93:function(){if(this.mb12){return}var b=this.en47.up57();var c=[];var a="height:6px;line-height:6px;width:6px;background:green;position:absolute;";c.push('<div style="; width:'+(b.w)+"px;height:"+(b.h)+"px;top:"+(b.y-2)+"px;left:"+(b.x-2)+'px;z-index:1;position:absolute;padding:2px;">');c.push('  <div name="selectBoxContainer" style="background:blue;filter:alpha(opacity=5);opacity: 0.1;width:100%;height:100%;border:1px dotted red;cursor:default;"></div>');c.push('  <div dir="wn" name="selectBox" style="'+a+'top:0;left:0;cursor:nw-resize">&nbsp;</div>');c.push('  <div dir="ne" name="selectBox" style="'+a+'top:0;right:-1px;cursor:ne-resize">&nbsp;</div>');c.push('  <div dir="es" name="selectBox" style="'+a+'bottom:-1px;right:-1px;cursor:nw-resize"">&nbsp;</div>');c.push('  <div dir="sw" name="selectBox" style="'+a+'bottom:-1px;left:0;cursor:ne-resize">&nbsp;</div>');c.push('  <div dir="w" name="selectBox" style="'+a+'top:48%;left:0;cursor:e-resize">&nbsp;</div>');c.push('  <div dir="e" name="selectBox" style="'+a+'top:48%;right:-1px;cursor:e-resize">&nbsp;</div>');c.push('  <div dir="n" name="selectBox" style="'+a+'left:48%;top:0;cursor:s-resize">&nbsp;</div>');c.push('  <div dir="s" name="selectBox" style="'+a+'left:48%;bottom:-1px;cursor:s-resize">&nbsp;</div>');c.push("</div>");this.mb12=$(c.join("")).appendTo(this.pc1.te17)[0];this.mb12.xg36=this;this.mb12.owner=this},bt94:function(){return this.mb12?true:false},clearSelection:function(){if(this.mb12){this.mb12.owner=null;this.mb12.parentNode.removeChild(this.mb12);this.mb12=null}},hz95:function(d,c){var e=this.ports;for(var b=0,a=e.length;b<a;b++){if(c){if(e[b].no81()!=c){e[b].cl59(d)}}else{e[b].cl59(d)}}},vv96:function(m,j,n){var k=this.ports;var a=1000,g;var b;for(var f=0,c=k.length;f<c;f++){if(k[f].no81()!=n){var e=k[f].up57();var h=justep.graphics.bz2.distance(e,{x:m,y:j});if(h<a){a=h;b=k[f]}}}return b},nh97:function(){if(this.mb12){var a=this.en47.up57();$(this.mb12).css({left:a.x-2,top:a.y-2,width:a.w,height:a.h})}},zd98:function(t,c){var B=t.target;c.te4=false;$.fn.setCapture(B);var g=c.mouseDownPos;var j=g?g.x:t.clientX;var h=g?g.y:t.clientY;var q=[];var k=this;var f=c.tz31;var o=f.length;var A=10000,w=10000,z=0,u=0;for(var r=0;r<o;r++){if(f[r].type!="connection"){var b=f[r].vn56();q.push({top:b.y,left:b.x});A=Math.min(A,b.x);w=Math.min(w,b.y);z=Math.max(z,b.x+b.w);u=Math.max(u,b.y+b.h)}}var n=[];var a=c.jp10;for(var m in a){var C=a[m];if(C.type!="connection"&&!C.bt94()){n.push(C.vn56())}}var v=document;var s={x:A,y:w,w:z-A,h:u-w};v.onmousemove=function(y){c.te4=true;y=y||window.event;var p=y.clientX-j;var d=y.clientY-h;if(p==0&&d==0){return}B.style.cursor="move";s.x=Math.max(A+p,9);s.y=Math.max(w+d,9);s=autoAlign(s,n,c.te17);for(var x=0;x<o;x++){if(f[x].type!="connection"){f[x].kn87();var l=f[x].bs20.vn56();l.x=f[x].vn56().x+(s.x-A);l.y=f[x].vn56().y+(s.y-w);f[x].bs20.xt52(l)}}};v.onmouseup=function(l){hiddenAlignLine(c.te17);l=l||window.event;$.fn.releaseCapture(B);v.onmousemove=null;v.onmouseup=null;B.style.cursor="default";if(l.clientX-j==0&&l.clientY-h==0){return}c.undoManager.zw160();for(var d=0;d<o;d++){if(f[d].type!="connection"){if(f[d].bs20){c.undoManager.jr165(f[d].id,f[d].bs20.vn56());f[d].bs20.do63();f[d].bs20=null}}}c.undoManager.sv161();c.vg134();c.fireFigureStyleChanged()}},br99:function(n,b){var m=n.srcElement||n.target;$.fn.setCapture(m);var a=[];var f=b.tz31.length;for(var j=0;j<f;j++){var d=$(b.tz31[j].mb12);var p=d.position();a.push({top:p.top,left:p.left,width:d.outerWidth(),height:d.outerHeight()})}var q=n.clientX;var o=n.clientY;var c=m.getAttribute("dir");var s=20,g=20;var r=this;var k=function(A){A=A||window.event;var G=A.clientX-q;var F=A.clientY-o;var v=b.lv29.scrollLeft;var t=b.lv29.scrollTop;for(var y=0;y<f;y++){var u=b.tz31[y].mb12;if(b.tz31[y] instanceof justep[b.figureType].at49){var x=G>0?1:-1,w=F>0?1:-1;G=F=Math.min(Math.abs(G),Math.abs(F));G=x*G;F=w*F}var l=a[y].width+G,z=a[y].width-G,C=a[y].height+F,D=a[y].height-F,B=a[y].top+F+t,E=a[y].left+G+v;if(c=="es"){if(l>g&&C>s){$(u).width(l).height(C)}}else{if(c=="e"){if(l>g){$(u).width(l)}}else{if(c=="s"){if(C>s){$(u).height(C)}}else{if(c=="wn"){if(B>2&&E>2&&z-2>g&&D-2>s){$(u).css({top:B,left:E,width:z-2,height:D-2})}}else{if(c=="w"){if(E>2&&z-2>g){$(u).css({left:E,width:z-2})}}else{if(c=="n"){if(B>2&&D-2>s){$(u).css({top:B,height:D-2})}}else{if(c=="ne"){if(B>2&&l-2>g&&D-2>s){$(u).css({top:B,width:l-2,height:D-2})}}else{if(c=="sw"){if(E>2&&C-2>s&&z-2>g){$(u).css({left:E,height:C-2,width:z-2})}}}}}}}}}}};var h=function(A){A=A||window.event;$.fn.releaseCapture(m);if($.browser.msie){$(m).unbind("mousemove");$(m).unbind("mouseup")}else{$(document.body).unbind("mousemove");$(document.body).unbind("mouseup")}if(A.clientX-q==0&&A.clientY-o==0){return}var w=b.lv29.scrollLeft;var u=b.lv29.scrollTop;b.undoManager.zw160();for(var y=0,x=b.tz31.length;y<x;y++){var v=$(b.tz31[y].mb12);var C=v.position();var E=C.left-a[y].left;var D=C.top-a[y].top;var t=v.outerWidth()-a[y].width;var B=v.outerHeight()-a[y].height;var z=$.extend({},b.tz31[y].vn56());z.x+=E;z.y+=D;z.w+=t;z.h+=B;b.undoManager.jr165(b.tz31[y].id,z)}b.undoManager.sv161();r=null;b.vg134();b.fireFigureStyleChanged()};if($.browser.msie){$(m).bind("mousemove",k);$(m).bind({mouseup:h})}else{$(document.body).bind("mousemove",k);$(document.body).bind({mouseup:h})}},ll100:function(){var c=this.ports;if(c){for(var b=0,a=c.length;b<a;b++){c[b].vb85()}}},do63:function(){this.clearSelection();if(this.ports){for(var b=0,a=this.ports.length;b<a;b++){this.ports[b].do63()}}this.en47.cb26.xg36=null;this.en47.do63();for(var c in this){this[c]=null}}};justep.graphics.jo43=function(d,c){this.modelData=c;this.id=c.id;this.pc1=d;this.figureType=d.figureType;var b=c.style;b.parent=d.lv29;if(b.points){b.shape=b.points;b.points=null;delete b.points}this.en47=new justep[this.figureType]["ud18"](b);this.en47.cb26.xg36=this;this.en47.ax33.xg36=this;this.type=c.type;c.varIn=c.varIn||"x";c.varOut=c.varOut||"x";var a=c.LABEL||c.text||b.LABEL;var e=d.jp10[c.sourceNode];var g=d.jp10[c.targetNode];if(e&&g){var f={"0":"n","1":"e","2":"s","3":"w"};this.sm102(g.ca92("inPort",f[b.inPortDir]||(b.inPortDir+"")),"inPort");this.sm102(e.ca92("outPort",f[b.outPortDir]||(b.outPortDir+"")),"outPort")}else{}this.en47.ih53({color:"black",weight:"1px"});this.en47.wf64();if(a){this.setText(a)}};justep.graphics.jo43.prototype={ar101:function(m){if(!m.modelData||!m.modelData.xmlNode){return}var h=m.modelData.xmlNode;var c=$("true-output",h);var e=$("false-output",h);var a=m.getBindingConnections();var l=false,j=false;var f=[];for(var d=0;d<a.length;d++){if(a[d].outPort.owner==m){if(!a[d].inPort){continue}var b=a[d].inPort.owner.wt89();if(b==c.attr("unit")){l=true}else{if(b==e.attr("unit")){j=true}else{f.push(a[d])}}}}if(!l){c.remove()}if(!j){e.remove()}var g,k;if(!l&&!j){g=f[0];k=f[1]}else{if(!l){g=f[0]}else{if(!j){k=f[0]}}}if(g){$(h).appendXml('<true-output xmlns="http://www.justep.com/model" name="x" unit="'+g.inPort.owner.wt89()+'"/>');g.setText("是")}if(k){$(h).appendXml('<false-output xmlns="http://www.justep.com/model" name="x" unit="'+k.inPort.owner.wt89()+'"/>');k.setText("否")}},xd86:function(){return this.en47},wt89:function(){if(!this.modelData.name){if(this.inPort&&this.outPort&&this.outPort.owner&&this.inPort.owner){this.modelData.name=this.outPort.owner.wt89()+"|"+this.inPort.owner.wt89()}}return this.modelData.name},tq90:function(){return this.modelData.type},qa88:function(){return{figureType:this.tq90(),name:this.wt89(),LABEL:this.uc58(),sourceNode:this.outPort.owner.wt89(),targetNode:this.inPort.owner.wt89(),varIn:this.modelData.varIn,varOut:this.modelData.varOut}},vn56:function(){return this.en47.vn56()},xt52:function(a,b){this.en47.xt52(a);if(!b){this.pf104()}},up57:function(){return this.en47.up57()},setText:function(a){this.en47.setText(a)},uc58:function(){return this.en47.uc58()},sm102:function(d,a,c){if(d){var e=this[a];if(e){e.removeConnection(this)}d.pd79(this,a);if(a=="inPort"){this.modelData.targetNode=d.owner.id}else{if(a=="outPort"){this.modelData.sourceNode=d.owner.id}}this[a]=d;if(this.inPort&&this.outPort){if(c){d.gj84(this)}else{var b=this.vn56();if(b.length==2&&Math.abs(b[0].x-b[1].x)<2&&Math.abs(b[0].y-b[1].y)<2){d.gj84(this)}}this.modelData.name=this.outPort.owner.wt89()+"|"+this.inPort.owner.wt89();if(this.outPort&&this.outPort.owner.type=="conditionBranch"){this.ar101(this.outPort.owner)}}}},mx103:function(s){s=s||window.event;var u=s.srcElement||s.target;$.fn.setCapture(u);var h=s.clientX;var g=s.clientY;var n=u.index;var j=u.lm48;var a=this.vn56();var w=[];for(var r=0,p=a.length;r<p;r++){w.push($.extend({},a[r]))}var f=n==0?"outPort":"inPort";var o={x:a[n].x,y:a[n].y};var m,v;var d=j.pc1.jp10;var b=j.pc1;var c=n==0?j.inPort.owner:j.outPort.owner;var t=function(C){C=C||window.event;var z=C.clientX-h;var y=C.clientY-g;if(C.clientX<10||C.clientY<10){return}a=j.vn56();n=n==0?0:a.length-1;var B=n==0?"inPort":"outPort";a[n].x=o.x+z;a[n].y=o.y+y;a=justep.graphics.bz2.manhattanRoute(j);for(var A=0,x=a.length;A<x;A++){if(a[A].x<0){a[A].x=1}if(a[A].y<0){a[A].y=1}}j.xt52(a,true);v=b.sg115(a[n],B);if(v){if(v!=this.gs3){if(this.gs3){this.gs3.hd83(false);if(this.gs3.ower!=v.owner){this.gs3.owner.hz95(false)}this.gs3=null}if(!b.zi80(c,v.owner,n==0?"outPort":"inPort",j)){this.gs3=v;v.owner.hz95(true,B);v.hd83(true)}else{v=null}}}else{if(this.gs3){this.gs3.owner.hz95(false);this.gs3=null}}};var k=$(u);if(!$.browser.msie){k=$(document.body)}var q=function(x){x=x||window.event;k.unbind("mousemove").unbind("mouseup");if(b.am14){b.am14.hz95(false)}if(v&&v!=j.inPort&&j!=j.outPort){var i=j.outPort.owner.wt89();var l=j.inPort.owner.wt89();b.oq139(j);j.pc1.undoManager.uz166(j.id,v,f);v.hd83(false);j.pc1.vg134();b.qo138(j);var y={eventType:"portChanged",jsFunc:"",portType:v.no81(),oldSourceNode:i,newSourceNode:j.outPort.owner.wt89(),oldTargetNode:l,newTargetNode:j.inPort.owner.wt89(),styles:b.getFigureStyles()};b.dispatchEvent(y)}else{j.xt52(w)}if(this.gs3){this.gs3.owner.hz95(false);this.gs3=null}$.fn.releaseCapture(u);w=null;j.pc1.am14=null;j.pc1.co21=null;v=null};k.bind({mousemove:t,mouseup:q})},bb93:function(){if(this.ux6){return}this.ux6=[];var g=this.pc1.te17;var d="height:6px;line-height:6px;width:6px;background:green;position:absolute;z-index:1000;font-size:0;";var c=this.en47.vn56();var b=this;for(var e=0,a=1;e<c.length;e++){var f=$('<div style="'+d+"top:"+(c[e].y-2)+"px;left:"+(c[e].x-3)+'px;">&nbsp;</div>').appendTo(g)[0];if(e==0||e==c.length-1){f.style.cursor="move";$(f).bind("mousedown",function(h){b.mx103(h)})}this.ux6.push(f);f.lm48=this;f.index=e}this.en47.ih53({color:"red",weight:"2"})},bt94:function(){return this.ux6?true:false},clearSelection:function(){if(this.ux6){this.en47.ih53({color:"black",weight:"1px"});for(var b=0,a=this.ux6.length;b<a;b++){this.ux6[b].lm48=null;this.ux6[b].index=null;this.ux6[b].onmousedown=null;this.ux6[b].parentNode.removeChild(this.ux6[b])}this.ux6=null}},br99:function(){},zd98:function(s,c){var u=s.srcElement||s.target;c.te4=false;var m=this;var g=s.clientX;var f=s.clientY;var n=c.tz31.length;var m=this;var a=this.vn56();var p=c.te17.scrollLeft;var b=c.te17.scrollTop;var j=-1;for(var r=0,n=a.length-1;r<n;r+=1){if(justep.graphics.bz2.containInLine(g+p-$(c.te17).offset().left,f+b-$(c.te17).offset().top,[a[r],a[r+1]])){j=r;break}}if(j<=0||j==a.length-2){$.fn.releaseCapture(u);return}var q=[{x:a[j].x,y:a[j].y},{x:a[j+1].x,y:a[j+1].y}];var d=c.ss129({type:"ud18",shape:q});d.ih53({color:"red"});var u=d.cb26;u.style.display="none";$.fn.setCapture(u);var v=[a[j].x,a[j].y,a[j+1].x,a[j+1].y];var k=a[j].x==a[j+1].x?false:true;var h=$(u);if(!$.browser.msie){h=$(document.body)}var t=function(y){c.te4=true;y=y||window.event;if(y.clientX-g==0&&y.clientY-f==0){return}u.style.cursor="move";var C=y.clientX-g;var B=y.clientY-f;u.style.display="";var x=c.lv29.scrollLeft;var w=c.lv29.scrollTop;var l=v[0]+C,A=v[1]+B,i=v[2]+C,z=v[3]+B;if(!k){if(v[0]+C>2){q[0].x=v[0]+C}if(v[2]+C>2){q[0+1].x=v[2]+C}}else{if(v[1]+B>2){q[0].y=v[1]+B}if(v[3]+B>2){q[0+1].y=v[3]+B}}d.xt52(q)};var o=function(i){i=i||window.event;$.fn.releaseCapture(u);u.style.cursor="default";h.unbind("mousemove").unbind("mouseup");a=$.extend(true,[],a);if(i.clientX!=g||i.clientY!=f){a[j].x=q[0].x;a[j].y=q[0].y;a[j+1].x=q[1].x;a[j+1].y=q[1].y;a[j].cusMove=true;a[j+1].cusMove=true;c.undoManager.jr165(m.id,a);c.vg134();c.fireFigureStyleChanged()}d.do63();u=null;target=null;m=null};h.bind({mousemove:t,mouseup:o})},pf104:function(){if(this.ux6){var b=this.vn56();for(var c=0,a=b.length;c<a;c++){$(this.ux6[c]).css({top:b[c].y-1,left:b[c].x-1})}}},do63:function(){this.clearSelection();if(this.inPort&&this.inPort.removeConnection){this.inPort.removeConnection(this)}if(this.outPort&&this.outPort.removeConnection){this.outPort.removeConnection(this)}this.en47.cb26.xg36=null;this.en47.do63();for(var a in this){this[a]=null}}};justep.graphics.ProcessCanvas=function(a){if(!a){return}this.id=a.id;this.wd8=1;this.draggable=a.draggable;this.figureType=($.browser.msie&&$.browser.version<10)?"wq28":"se35";this.tz31=[];this.jp10={};this.mm32=0;this.is105()};justep.graphics.ProcessCanvas.prototype={processFile:"unknown",is105:function(){this.te17=document.getElementById(this.id);if(this.figureType=="wq28"){document.namespaces.add("v","urn:schemas-microsoft-com:vml");this.lv29=document.createElement('<v:group style="WIDTH: 2000px; POSITION: absolute; HEIGHT: 3000px;border:2px solid green;" coordsize="2000,3000">');var a=document.createElement('<v:rect style="LEFT: 0px; WIDTH: 2000px; TOP: 0px; HEIGHT: 3000px" coordsize="21600,21600" filled="f" stroked="f"></v:rect>');this.lv29.appendChild(a)}else{this.lv29=document.getElementById("svgc")}this.te17.appendChild(this.lv29);this.xm106(this)},xm106:function(a){$(a.te17).bind({mousedown:function(b){a.ep109(b)},mouseup:function(b){a.nk112(b)},mousemove:function(b){a.cm111(b)},dblclick:function(b){a.fi119(b)},keydown:function(b){a.an108(b)},contextmenu:function(b){a.cs114(b);return false}})},ce107:function(){$(self.te17).unbind()},an108:function(a){var a=window.event;if(a.keyCode==116){a.keyCode=0;a.cancelBubble=true;return false}if(a.ctrlKey&&a.keyCode==65){this.selectAll();a.keyCode=0;a.cancelBubble=true}this.gh142();var j=0,h=0;var e=this.tz31.length;if(e>0){switch(a.keyCode){case 37:j=-1;break;case 38:h=-1;break;case 39:j=1;break;case 40:h=1;break}if(j!=0||h!=0){for(var d=0,b=this.tz31.length;d<b;d++){var g=this.tz31[d];if(g instanceof justep.graphics.ProcessRect){var f=g.vn56();f.x+=j;f.y+=h;g.xt52(f)}}this.vg134();this.ip143();return}}if(a.keyCode==27){this.selectProcessItemType()}else{if(a.keyCode==46){this.removeSelections()}else{if(a.keyCode==83&&a.ctrlKey){var c={eventType:"save",jsFunc:"",styles:this.getFigureStyles()};this.dispatchEvent(c)}else{if(a.ctrlKey){if(a.keyCode==89){this.dispatchEvent({eventType:"redo"})}else{if(a.keyCode==90){this.dispatchEvent({eventType:"undo"})}}}}}}this.ip143()},ep109:function(d){d=d||window.event;var c=d.srcElement||d.target;this.oldStyle=this.getFigureStyles();if(d.button==2){this.selectProcessItemType()}if(this.ft0){this.ft0.blur()}var b=this.bf125(c);if(!b&&this.mr126(d.clientX,d.clientY)||c.lm48){return}this.mouseDownPos={x:d.clientX,y:d.clientY};this.fa15=true;if(this.xz19){if(this.xz19!="connection"){var a=this.undoManager.uy163({type:this.xz19,style:{shape:{x:d.clientX+this.te17.scrollLeft-$(this.te17).offset().left-3,y:d.clientY+this.te17.scrollTop-3-$(this.te17).offset().top}}});this.tk141(a);this.bb93(a)}else{if(this.tv34){this.lz50=this.tv34;this.fc9=this.ss129({type:"ud18",shape:[this.lz50.tn82(),{x:d.clientX+this.te17.scrollLeft-$(this.te17).offset().left+1,y:d.clientY+this.te17.scrollTop+1-$(this.te17).offset().top}]})}}return}if(c.getAttribute("name")=="selectBox"){c.parentNode.owner.br99(d,this)}else{if(c.getAttribute("name")=="selectBoxContainer"){if(!d.ctrlKey){c.parentNode.owner.zd98(d,this)}}else{if(b&&b.ly16){if(!d.ctrlKey){if(!b.bt94()){if(this.ij110(d,b)){this.lq137(d,b)}}if(b.bt94()){this.ff44=b}}}else{if(!this.mr126(d.clientX,d.clientY)){this.ar7=true}}}}},ij110:function(g,b){if(b.en47 instanceof justep.se35.ud18){var a=g.layerX;var j=g.layerY;var d=b.en47.vn56();for(var c=0;c<=d.length-2;c++){var h=d[c];var f=d[c+1];if(h.x==f.x){if(h.x-10<a&&a<h.x+10&&Math.min(h.y,f.y)<=j&&j<=Math.max(h.y,f.y)){return true}}else{if(h.y-10<j&&j<h.y+10&&Math.min(h.x,f.x)<=a&&a<=Math.max(h.x,f.x)){return true}}}return false}return true},cm111:function(d){d=d||window.event;if(this.xz19){if(this.xz19=="connection"){if(!this.fa15||(this.fa15&&this.lz50)){var c=this.fa15?"outPort":"inPort";var a=this.sg115({x:d.clientX+this.te17.scrollLeft-$(this.te17).offset().left,y:d.clientY+this.te17.scrollTop-$(this.te17).offset().top},c,this.lz50?this.lz50.owner:null);if(a){if(a!=this.tv34){if(this.tv34){this.tv34.hd83(false);if(this.tv34.ower!=a.owner){this.tv34.owner.hz95(false)}this.tv34=null}if(!this.lz50||!this.zi80(this.lz50.owner,a.owner,"inPort")){this.tv34=a;a.owner.hz95(true,c);a.hd83(true)}else{a=null}}}else{if(this.tv34){this.tv34.owner.hz95(false);this.tv34=null}}}if(this.fa15&&this.fc9){var b=this.fc9.vn56();b[b.length-1].x=d.clientX+this.te17.scrollLeft-$(this.te17).offset().left;b[b.length-1].y=d.clientY+this.te17.scrollTop-$(this.te17).offset().top;this.fc9.xt52(b)}}return}if(this.ff44){this.ff44.zd98(d,this);this.ff44=null}else{if(this.fa15&&this.ar7&&!this.mp22){this.uh113(d,this)}}},nk112:function(f){f=f||window.event;var d=f.srcElement||f.target;if(d==this.te17&&this.mr126(f.clientX,f.clientY)){return}this.fa15=false;this.ff44=null;if(this.xz19){if(this.fc9){if(this.tv34&&this.lz50.owner.id!=this.tv34.owner.id){var c=this.fc9.vn56();var a=this.undoManager.uy163({sourceNode:this.lz50.owner.id,targetNode:this.tv34.owner.id,type:this.xz19,style:{outPortDir:this.lz50.direction,inPortDir:this.tv34.direction,shape:c}});this.tk141(a);this.bb93(a)}this.fc9.do63();this.fc9=null;this.vg134()}if(this.tv34){this.tv34.owner.hz95(false)}this.selectProcessItemType();this.xz19=null;this.tv34=null;this.tv34=null;this.lz50=null;this.te4=false;this.ar7=false;return}if(d.lm48){this.te4=false;this.ar7=false;return}if(f.ctrlKey){var b=this.bf125(d);if(b&&b.ly16){this.lq137(f,b)}else{if(d.getAttribute("name")=="selectBoxContainer"){this.lq137(f,d.parentNode.owner.target)}}}else{if(!this.te4&&d.getAttribute("name")=="selectBoxContainer"){this.lq137(f,d.parentNode.owner||this.bf125(d))}else{if(this.ar7){this.clearSelection();this.selectProcessRoot()}else{var b=this.bf125(d);if(b&&b.ly16){this.lq137(f,b)}}}}this.te4=false;this.ar7=false},uh113:function(g,k){var j=g.clientX+k.te17.scrollLeft-$(k.te17).offset().left-3,i=g.clientY+k.te17.scrollTop-3-$(k.te17).offset().top;var h=document;var f=$("<div style='background:blue; filter:alpha(opacity=10);opacity:0.1; border:1px dotted green;position:absolute;top:"+i+"px;left:"+j+"px;font-size:0;height:1px;'>&nbsp;</div>").appendTo(k.te17);$.fn.setCapture(f[0]);this.mp22=f;var a=$(h.body);var c=function(m){m=m||window.event;var d=m.clientX-j+ +k.te17.scrollLeft-$(k.te17).offset().left;var l=m.clientY-i+k.te17.scrollTop-$(k.te17).offset().top;if(d<1){f.css("left",j+d)}f.width(Math.abs(d));if(l<1){f.css("top",i+l)}f.height(Math.abs(l))};var b=function(r){a.unbind("mousemove").unbind("mouseup");var s=f.position();var l={x:s.left+k.te17.scrollLeft,y:s.top+k.te17.scrollTop,w:f.width(),h:f.height()};var n=k.jp10;k.clearSelection();var o;for(var q in n){var d=n[q];if(d instanceof justep.graphics.ProcessRect){k.oq139(d);var m=d.up57();if(k.cp118(l,m)){k.qo138(d,true);o=d}}else{if(d instanceof justep.graphics.jo43){}}}if(o){k.nt140("add",o)}$.fn.releaseCapture(f[0]);f.remove().empty();f=null;k.mp22=null;k.fa15=false;k.ff44=null;k.te4=false;k.ar7=false;k=null};a.bind({mousemove:c,mouseup:b})},cs114:function(d){d=d||window.event;this.popuPos={x:d.clientX-$(this.te17).offset().left,y:d.clientY+this.te17.scrollTop};var b=d.srcElement||d.target;this.currentFigure=null;var a=this.bf125(b);if(b.getAttribute("name")=="selectBoxContainer"){a=b.parentNode.owner}var c=false;if(a){this.currentFigure=a;c=true}else{this.currentFigure=null;var g=$(this.te17).position();this.menuPos={x:d.clientX-g.left-$(this.te17).offset().left,y:d.clientY-g.top+this.te17.scrollTop-50}}var f={eventType:"contextmenu",jsFunc:"",haveSelect:c};this.dispatchEvent(f);return false},zi80:function(g,b,a,d){if(g==b){return true}if(g&&b){var f=g.getBindingConnections();for(var e=0,c=f.length;e<c;e++){if(f[e]!=d&&f[e][a].owner==b){return true}}}},sg115:function(b,c,g){var e=this.jp10;for(var f in e){var a=e[f];if(a.ly16&&a.type!="connection"){var d=a.up57();if(b&&justep.graphics.bz2.containInRect(b.x,b.y,{x:d.x-5,y:d.y-5,w:d.w+5,h:d.h+5})&&a!=g){return a.vv96(b.x,b.y,c)}}}},us116:function(c){var a=this.wd8++;var b=c+a;if(!this.vs117(b)){this.wd8=1;return a}else{var a=this.us116(c);if(a){return a}}},vs117:function(b){var c=this.jp10;for(var d in c){var a=c[d];if(b==a.wt89()){return a}}},dispatchEvent:function(a){this.eventData=a},cp118:function(b,a){return Math.abs((b.x+b.x+b.w)-(a.x+a.x+a.w))<(b.x+b.w+a.x+a.w-b.x-a.x)&&Math.abs((b.y+b.y+b.h)-(a.y+a.y+a.h))<(b.y+b.h+a.y+a.h-b.y-a.y)},fi119:function(f){f=f||window.event;var d=f.srcElement||f.target;var c=this.bf125(d);if(c&&c.type=="connection"){var b=event.clientX+this.te17.scrollLeft-$(this.te17).offset().left;var g=event.clientY+this.te17.scrollTop-$(this.te17).offset().top;var a=this.ry123(c,{x:b,y:g});this.nl120(c,a+1,{x:b,y:g});this.nl120(c,a+2,{x:b,y:g})}else{if(c){this.do124(c)}else{if(d.lm48){this.yr121(d.lm48,d.index)}}}},nl120:function(d,a,b){a=parseInt(a);var c=d.vn56();var f=c[a-1];var e=c[a];if(f&&f.x==e.x){b.x=f.x}else{if(f&&f.y==e.y){b.y=f.y}else{if(e){b.x=e.x;b.y=e.y}}}c.splice(a,0,b);this.oq139(d);d.xt52(c);this.qo138(d)},yr121:function(d,b){b=parseInt(b);var c=d.vn56();if(b>1&&b<(c.length-2)){if(b+2==(c.length-1)){b-=1}if(b-1==0){b+=1}var g=c[b-1],f=c[b],e=c[b+1];if((g.x==f.x&&g.y==f.y)){c.splice(b-1,2)}else{if((f.x==e.x&&f.y==e.y)){c.splice(b,2)}else{var a=this.ek122(g,f,e);c.splice(b-1,3,a)}}this.oq139(d);d.xt52(c);this.qo138(d)}},ek122:function(d,c,a){var b={};if(d.x==c.x&&c.y==a.y){b.x=a.x;b.y=d.y}else{if(d.y==c.y&&c.x==a.x){b.x=d.x;b.y=a.y}else{if(d.x<c.x&&c.y<a.y){b.x=d.x;b.y=a.y}else{if(d.x>c.x&&c.y<a.y){b.x=d.x;b.y=a.y}else{if(d.x<c.x&&c.y>a.y){b.x=d.x;b.y=a.y}}}}}return b},ry123:function(e,a){var f=-1;var d=e.vn56();for(var g=0,c=d.length;g<c;g++){if((g+1)<d.length){var b=justep.graphics.bz2.containInLine(a.x,a.y,[{x:d[g].x,y:d[g].y},{x:d[g+1].x,y:d[g+1].y}]);if(b==true){return g}}}return f},do124:function(a){return;this.bb93(a);var g=a.en47.ax33;var d=a.vn56();document.body.onselectstart="";this.fl11=true;var c=document.createElement("<textarea  style='border:1px solid;position:absolute;font:normal 12px 宋体, arial, serif;overflow:visible;word-wrap:normal'/>");this.te17.appendChild(c);var e=g.offsetWidth+30;if(e<50){e=50}$(c).css({left:d.x+d.w/2-e/2,top:g.offsetTop,width:e});c.onmousedown=function(){window.event.cancelBubble=true};c.onmouseup=function(){window.event.cancelBubble=true};c.onmousemove=function(){window.event.cancelBubble=true};c.onkeydown=function(){if(event.keyCode==13){if(event.altKey){var h=document.selection.createRange();h.text="\r\n"}else{c.onblur()}}window.event.cancelBubble=true};c.value=a.uc58().sn72("@br@","\r\n");c.focus();var f=c.createTextRange();f.moveStart("character",c.value.length);f.collapse(true);f.select();var b=this;b.ft0=c;c.onblur=function(){document.body.onselectstart=function(){return false};var h=c.value;h=h.sn72("\r\n","@br@");if(a.uc58()!=h){var i={eventType:"updateNodeName",jsFunc:"",nodeName:a.modelData.name,nodeValue:h};a.modelData.LABEL=h;a.setText(h);if(b.co151){b.co151("label",h)}b.dispatchEvent(i);b.fireFigureStyleChanged()}b.ft0=null;b.fl11=false;b.te17.removeChild(c)}},bf125:function(b){var c=b;while(c){var a=c.xg36;if(a){return a}c=c.parentNode}},mr126:function(a,b){if((this.te17.scrollHeight!=this.te17.clientHeight&&a>this.te17.clientWidth)||(this.te17.scrollWidth!=this.te17.clientWidth&&b>this.te17.clientHeight)){return true}return false},dk127:function(c){var d={businessActivity:"lp39",conditionActivity:"xu5",connection:"ud18",conditionBranch:"nf23",and:"at49",xor:"at49",start:"at49",end:"at49",autoActivity:"sb24"};var b=c.type;if(!c.id){c.id=b+new Date().getTime()}var a;if(this.initData){$.extend(c,this.initData);this.initData=null}if(b!="connection"){a=new justep.graphics.ProcessRect(this,c)}else{a=new justep.graphics.jo43(this,c)}a.ly16=true;this.jp10[a.id]=a;return a},ye128:function(){this.undoManager.ye128();this.clearSelection();for(var a in this.jp10){this.jp10[a].do63()}this.jp10={}},loadData:function(k){this.ye128();if(!k||k==""){return}this.version=k.version;this.modelData=k;var d=k.processMainData||{};var m=[];for(var b in d){var e=d[b];e.id=b;if(e.style&&e.type!="connection"){this.dk127(e)}else{if(e.type=="connection"){m.push(e)}}}for(var f=0,c=m.length;f<c;f++){var e=m[f];var a=this.jp10[e.sourceNode];var g=this.jp10[e.targetNode];if(!a||!g){continue}this.dk127(e)}if(!this.version){var j=this.jp10;for(var b in j){var h=j[b];if(h.type!="connection"){h.ll100()}}}},ss129:function(a){a.parent=this.lv29;return new justep[this.figureType][a.type](a)},selectProcessItemType:function(e,c,b){if(!e){this.initData=null;this.xz19=null;this.te17.style.cursor="default";return}var d=this.lk131(e);if(d){this.te17.style.cursor="default";alert(d);return}this.initData=b;this.xz19=e;this.te17.style.cursor=e?"crosshair":"default";if(e&&e!="connection"&&this.tz31.length>0){this.qu130(e);return}if(e&&c){if(this.popuPos){this.te17.style.cursor="default";this.xz19=null;var a=this.dk127({type:e,style:{shape:{x:this.popuPos.x-5,y:this.popuPos.y-5}}});this.bb93(a)}}},qu130:function(t){var p,f,s=this.direction||"s";for(var r=0,m=this.tz31.length;r<m;r++){if(this.tz31[r] instanceof justep.graphics.ProcessRect&&this.tz31[r].type!="end"){p=this.tz31[r];if(p.type=="conditionBranch"){if(!this.direction){s="w";f=p.ca92("outPort","w");if(f.zi80()){s="e";f=p.ca92("outPort","e")}}else{f=p.ca92("outPort",s)}}else{f=p.ca92("outPort",s)}if(!f){f=p.ca92("outPort")}if(f){break}}}if(f){var n=p.up57();this.undoManager.zw160();var q=this.undoManager.uy163({type:t,style:{shape:{x:n.x,y:n.y}}});var k=q.up57();var j=p.tn82();var h=q.tn82();var e=n.x,d=n.y,b=25,o;switch(s){case"n":d-=(k.h+b);e-=(h.x-j.x);o="s";break;case"e":e+=(n.w+b);d-=(h.y-j.y);o="w";break;case"s":d+=(n.h+b);e-=(h.x-j.x);o="n";break;case"w":e-=(k.w+b);d-=(h.y-j.y);o="e"}var a=q.vn56();a.x=Math.max(e,9);a.y=Math.max(d,9);q.xt52(a);this.tk141(q);var c=q.ca92("inPort",o);if(!c){c=q.ca92("inPort")}if(c){var g=this.undoManager.uy163({type:"connection",sourceNode:f.owner.id,targetNode:c.owner.id,style:{outPortDir:f.direction,inPortDir:c.direction,shape:[f.tn82(),c.tn82()]}});this.tk141(g)}this.xz19=null;this.te17.style.cursor="default";this.bb93(q);this.undoManager.sv161()}},lk131:function(b){var a=this.jp10;if(b=="start"||b=="end"){for(var c in a){if(a[c].type==b){return"只能创建一个开始或者结束节点！"}}}},bu132:function(b){var a=[];for(var c in this.jp10){if(this.jp10[c].type=="connection"){a.push(this.jp10[c])}}return a},sy133:function(c){var b=c.vn56();for(var d=0,a=b.length;d<a;d++){if(b[d].cusMove){delete b[d].cusMove}}},vg134:function(){this.arcs={};var d=this.bu132(true);for(var e=0,b=d.length;e<b;e++){var a=d[e];var c=a.vn56();var f=this.in136(a,e+1,d);if(f){a.xt52(c)}}},ef135:function(b,a){if(b.x==a.x){return(a.y-b.y>0)?justep.it45.DOWN:justep.it45.UP}else{if(b.y==a.y){return(a.x-b.x>0)?justep.it45.RIGHT:justep.it45.LEFT}}},arcR:4,in136:function(C,b,k){var g=this.arcR;var c=false;var t=C.vn56();var p=k.length;for(var q=0;q<t.length-1;q++){if(t[q].attach){t[q].attach=null;delete t[q].attach;c=true}var B=Math.min(t[q].x,t[q+1].x),z=Math.min(t[q].y,t[q+1].y);var A=Math.max(t[q].x,t[q+1].x),w=Math.max(t[q].y,t[q+1].y);var m=this.ef135(t[q],t[q+1]);for(var v=b;v<p;v++){var e=k[v].vn56();if(t[q].x==t[q+1].x){for(var o=0;o<e.length-1;o+=1){if(e[o].y==e[o+1].y&&(t[q].x>Math.min(e[o].x,e[o+1].x)&&t[q].x<Math.max(e[o].x,e[o+1].x))&&(e[o].y>z&&e[o].y<w)){t[q].attach=t[q].attach||[];var f=t[q].x,d=e[o].y;var h=f+" "+(d-g)+" C"+(f-g)+" "+(d-g)+" "+(f-g)+" "+(d+g)+" "+f+" "+(d+g);if(m==justep.it45.UP){h=f+" "+(d+g)+" C"+(f-g)+" "+(d+g)+" "+(f-g)+" "+(d-g)+" "+f+" "+(d-g)}t[q].attach.push({v:h,pos:d,x:f,y:d});c=true}}}else{if(t[q].y==t[q+1].y){for(var o=0;o<e.length-1;o+=1){if(e[o].x==e[o+1].x&&(t[q].y>Math.min(e[o].y,e[o+1].y)&&t[q].y<Math.max(e[o].y,e[o+1].y))&&(e[o].x>B&&e[o].x<A)){t[q].attach=t[q].attach||[];var f=e[o].x,d=t[q].y;var h=(f-g)+" "+d+" C"+(f-g)+" "+(d-g)+" "+(f+g)+" "+(d-g)+" "+(f+g)+" "+d;if(m==justep.it45.LEFT){h=(f+g)+" "+d+" C"+(f+g)+" "+(d-g)+" "+(f-g)+" "+(d-g)+" "+(f-g)+" "+d}t[q].attach.push({v:h,pos:f,x:f,y:d});c=true}}}}}if(t[q].attach){var u=t[q].attach.sort(function(j,i){if(m==justep.it45.UP||m==justep.it45.LEFT){return j.pos>i.pos?-1:1}return j.pos>i.pos?1:-1});var a=[];for(var r=0;r<u.length;r++){a.push(u[r].v)}t[q].attach=a.join(" L")}}return c},lq137:function(c,a){if(!a){return}if(this.fl11){return}var b=this.tz31.length;if(c.type=="mousedown"){if(!c.ctrlKey&&b<=1){this.bb93(a)}}else{if(c.ctrlKey){if(a.bt94()){this.oq139(a)}else{this.qo138(a)}}else{if(b>1&&c.button!=2){this.bb93(a)}}}},qo138:function(a,b){if(!a.bt94()){a.bb93();this.tz31.push(a);if(!b){this.nt140("add",a)}}},bb93:function(a){this.clearSelection();this.qo138(a)},oq139:function(c){var a=false;for(var b=0;b<this.tz31.length;b++){if(this.tz31[b]==c){this.tz31[b].clearSelection();this.tz31.splice(b,1);a=true;break}}if(a){this.nt140("unselect")}},clearSelection:function(){for(var b=0,a=this.tz31.length;b<a;b++){this.tz31[b].clearSelection()}this.tz31=[]},selectAll:function(){designer.clearSelection();var b=designer.jp10;var c;for(var d in b){var a=b[d];this.qo138(b[d],true);if(a.type!="connection"){c=a}}if(c){this.nt140("add",c)}},removeSelections:function(){var h=[];var a=[];this.deleteFigures=[];var f=this.tz31;var d={};for(var c=0,b=f.length;c<b;c++){if(f[c].status){alert("当前环节或者执行过的环节不允许删除！");return}}var e=[];for(var c=0,b=f.length;c<b;c++){e.push(f[c].id)}this.undoManager.ao164(e);this.tz31=[];var g={eventType:"figureRemoved",jsFunc:"",removeids:h.join(","),types:a.join(","),styles:this.getFigureStyles()};this.dispatchEvent(g)},fireFigureStyleChanged:function(){this.gh142();var a={eventType:"figureChanged",jsFunc:"",styles:this.getFigureStyles(),oldStyles:this.oldStyle};this.dispatchEvent(a);this.ip143()},nt140:function(b,a){if(!a){if(this.tz31.length>0){a=this.tz31[0]}}var c={eventType:"selectChanged",jsFunc:"",selectType:a?a.tq90():"",selectFigure:a?a.wt89():""};this.dispatchEvent(c)},tk141:function(a){var b={eventType:"figureAdded",jsFunc:"",styles:this.getFigureStyles()};$.extend(b,a.qa88());this.dispatchEvent(b)},gh142:function(){this.dispatchEvent({eventType:"startCache"})},ip143:function(){this.dispatchEvent({eventType:"endCache"})},setProcessFile:function(a){this.processFile=a||""},getFigureStyles:function(){var e={};var d=this.jp10;for(var f in d){var a=d[f];var c=a.wt89();if(a.type!="connection"){e[c]={shape:a.vn56(),LABEL:a.uc58()}}else{e[c]={LABEL:a.uc58(),outPortDir:a.outPort.direction,inPortDir:a.inPort.direction,targetNode:a.inPort.owner.wt89(),sourceNode:a.outPort.owner.wt89(),shape:a.vn56()}}}var b=this.processFile.sn72("\\\\","/");e={version:"2",shapeStyle:e,scale:this.scale,processFile:b.substring(b.lastIndexOf("/")+1)};return JSON.stringify(e)},cc144:function(a){var b=a.wt89();if(a.type!="connection"){return{shape:$.extend({},a.vn56()),LABEL:a.uc58()}}else{return{LABEL:a.uc58(),outPortDir:a.outPort.direction,inPortDir:a.inPort.direction,targetNode:a.inPort.owner.wt89(),sourceNode:a.outPort.owner.wt89(),shape:$.extend([],a.vn56())}}},selectProcessRoot:function(){var a={eventType:"selectChanged",jsFunc:"",selectType:"",selectFigure:""};this.dispatchEvent(a)},alignFigures:function(h){var f=this.tz31;if(f.length<2){return}var b={x:1800,y:1800};for(var e=0,c=f.length;e<c;e++){var a=f[e];if(a instanceof justep.graphics.ProcessRect){if(h=="h"){if(b.y>a.tn82().y){b=a.tn82()}}else{if(h=="v"){if(b.x>a.tn82().x){b=a.tn82()}}}}}var g=[];this.undoManager.zw160();for(var e=0,c=f.length;e<c;e++){var a=f[e];if(a instanceof justep.graphics.ProcessRect){var d=$.extend({},a.vn56());g.push({figureId:a.id,value:$({},a.up57())});if(h=="h"){d.y=b.y-d.h/2}else{if(h=="v"){d.x=b.x-d.w/2}}this.undoManager.jr165(a.id,d)}}this.undoManager.sv161();this.fireFigureStyleChanged()},do63:function(){this.ce107();this.ye128();this.te17.innerHTML="";this.te17.parentNode.removeChild(this.te17);for(var a in this){this[a]=null}}};function autoAlign(g,e,c){if(!e||e.length==0){return g}if(!c){c=document.body}if(!c.fv40){var b=$("<div style='left:0px;top:0;display:none;overflow:hidden;border-top:1px dotted green;position:absolute;width:100%;height:1px;'/>").appendTo(c)[0];c.fv40=b}if(!c.ps46){var b=$("<div style='top:0px;display:none;overflow:hidden;border-left:1px dotted green;position:absolute;width:1px;height:100%;'/>").appendTo(c)[0];c.ps46=b}var k={offset:10,bound:null,align:null};var o={offset:10,bound:null,align:null};for(var j=0;j<e.length;j++){var l=e[j];var d=Math.abs(g.y-l.y);if(d<k.offset){k.offset=d;k.bound=l;k.align="top"}if(Math.abs(l.h-g.h)>2){var a=Math.abs(g.y+g.h/2-l.y-l.h/2);if(a<k.offset){k.offset=a;k.bound=l;k.align="vcenter"}var n=Math.abs(g.y+g.h-l.y-l.h);if(n<k.offset){k.offset=n;k.bound=l;k.align="bottom"}}var h=Math.abs(g.x-l.x);if(h<o.offset){o.offset=h;o.bound=l;o.align="left"}if(Math.abs(l.w-g.w)>2){var f=Math.abs(g.x+g.w/2-l.x-l.w/2);if(f<o.offset){o.offset=f;o.bound=l;o.align="hcenter"}var m=Math.abs(g.x+g.w-l.x-l.w);if(m<o.offset){o.offset=m;o.bound=l;o.align="right"}}}if(k.bound){if(k.align=="top"){g.y=k.bound.y;c.fv40.style.top=(k.bound.y)+"px"}else{if(k.align=="vcenter"){g.y=k.bound.y+k.bound.h/2-g.h/2;c.fv40.style.top=(k.bound.y+k.bound.h/2)+"px"}else{g.y=k.bound.y+k.bound.h-g.h;c.fv40.style.top=(k.bound.y+k.bound.h)+"px"}}c.fv40.style.left=c.scrollLeft+"px";c.fv40.style.display="block"}else{c.fv40.style.display="none"}if(o.bound){if(o.align=="left"){g.x=o.bound.x;c.ps46.style.left=(o.bound.x)+"px"}else{if(o.align=="hcenter"){g.x=o.bound.x+o.bound.w/2-g.w/2;c.ps46.style.left=(o.bound.x+o.bound.w/2)+"px"}else{g.x=o.bound.x+o.bound.w-g.w;c.ps46.style.left=(o.bound.x+o.bound.w)+"px"}}c.ps46.style.top=c.scrollTop+"px";c.ps46.style.display="block"}else{c.ps46.style.display="none"}return g}function hiddenAlignLine(a){if(!a){a=document.body}if(a.fv40){a.fv40.style.display="none"}if(a.ps46){a.ps46.style.display="none"}}justep.graphics.ProcessWebCanvas=function(a){this.activities=a.activities;this.loadProcess=a.loadProcess;this.loadTemplate=a.loadTemplate;this.selectExecutor=a.selectExecutor;this.toolboxItems=a.toolboxItems;this.undoManager=justep.graphics.UndoRedoManager;this.undoManager.designer=this;justep.graphics.ProcessCanvas.call(this,a)};justep.graphics.ProcessWebCanvas.prototype=new justep.graphics.ProcessCanvas();justep.graphics.ProcessWebCanvas.prototype.nameMap={start:"start",end:"end",place:"place",arc:"connection",connection:"connection","and-activity":"and","xor-activity":"xor","business-activity":"businessActivity","if-else-activity":"conditionBranch","condition-activity":"conditionActivity","auto-activity":"autoActivity"};justep.graphics.ProcessWebCanvas.prototype.is105=function(){var c=document.getElementById(this.id);this.hb145(c,this);if(this.figureType=="wq28"){document.namespaces.add("v","urn:schemas-microsoft-com:vml");this.lv29=document.createElement("v:group");this.lv29.style.cssText="WIDTH: 100px; POSITION: absolute; HEIGHT: 100px;";this.lv29.setAttribute("coordsize","100,100");var d=justep.wq28.av42.prototype.al66(this.lv29,"v:rect","LEFT: 0px; WIDTH: 100px; TOP: 0px; HEIGHT: 100px",{filled:"f",stroked:"f"});this.te17.appendChild(this.lv29)}else{var b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.setAttribute("width",4000);b.setAttribute("height",2000);b.setAttribute("version","1.1%");this.lv29=b;this.te17.appendChild(b)}this.te17.appendChild(this.lv29);this.xm106(this);if(this.activities){this.initToolbox(this.activities)}var a=this;$(window).bind("resize",function(){a.fz155()})};justep.graphics.ProcessWebCanvas.prototype.setLoadTmplBtnVisible=function(a){$("button[name='loadTemplate']",this.te17.parentNode)[a?"show":"hide"]()};justep.graphics.ProcessWebCanvas.prototype.hb145=function(e,b){var d="";if(this.toolbar){for(var f in this.toolbar){var g=this.toolbar[f];d+='<button onclick="'+g.handler+';">'+g.text+"</button>"}}var c='<div style="position:relative;overflow:auto;"><div class="canvas-toolbar">'+d+'<button name="loadModel" class="tool-item" style="width:92px;"><span class="icon load-process" >加载流程图</span></button><button name="loadTemplate" class="tool-item" style="width:80px"><span class="icon load-template">加载模板</span></button><button name="copy" class="tool-item" style="text-align:left;"><span class="icon copy">复制</span></button><button name="delete" class="tool-item"><span class="icon remove">删除</span></button><button name="hAlign" class="tool-item" style="width:82px"><span class="icon h-align">水平对齐</span></button><button name="vAlign" class="tool-item" style="width:82px"><span class="icon v-align">垂直对齐</span></button><button name="undo" class="tool-item" disabled="true"><span class="icon undo">撤销</span></button><button name="redo" disabled="true" class="tool-item"><span class="icon redo">重做</span></button><button name="viewSoudce" class="tool-item" style="width:70px;display:none;">查看源码</button><button name="reload" class="tool-item" >刷新</button><span style="padding-left:10px;"></span><label style="font-size:10pt;padding-right:5px;">已流转</label><span style="width:15px;height:22px;display:inline;background:green;padding-left:30px;padding-top:3px;">&nbsp;</span><label style="font-size:10pt;padding-right:5px;padding-left:10px;">当前</label><span style="width:15px;height:22px;display:inline;background:#0080FF;padding-left:30px;padding-top:3px;">&nbsp;</span></div><div class="mydesigner" style="-moz-user-select:none;border:1px solid #8DB2E3;position:relative; width: 1000px; height:800px; ; overflow: auto" ></div><div class="toolbox" style="width:150px;height:800px;position:absolute;top:25px;left:999px;border:1px solid #8DB2E3;overflow:hidden;background:white;overflow:auto;">    <div class="toolbox-title"><span>环节列表</span></div>    <ul class="toolbox-items">       <li><a href="javascript:void(0);" onfocus="this.blur();" class="cancel-selected"  title="activity1">取消选择</a></li>       <li style="padding:0;margin:0;font-size:0;position:relative;height:12px;position:relative;"><div style="position:absolute;top:8px;left:0;border-top:1px dotted #8DB2E3;font-size:0;height:0px;width:100%;"></div></li><li style="padding:0;margin:0;position:relative;height:18px;position:relative;"><div style="position:absolute;top:8px;left:0;border-top:1px dotted #8DB2E3;font-size:0;height:0px;width:100%;"></div></li><li><a href="javascript:void(0);" onfocus="this.blur();" class="start" label="开始" >开始</a></li><li><a href="javascript:void(0);" onfocus="this.blur();" class="and-activity" label="and" title="conditionactivity1">and环节</a></li><li><a href="javascript:void(0);" onfocus="this.blur();" class="xor-activity"  label="xor" title="conditionactivity1">xor环节</a></li><li><a href="javascript:void(0);" onfocus="this.blur();" class="connection"  title="connection">连接</a></li></ul><textarea id="console" style="display:none;width:100%;height:200px;"></textarea></div><div class="prop-area" style="height:100px;border:1px solid #8DB2E3;">    <div class="toolbox-title"><span>属性列表</span></div>    <div class="prop-list"></div></div></div>';var a=$(c).appendTo(e||document.body).css({width:"100%",height:"100%"});this.te17=$(".mydesigner",a)[0];this.te17.style.cursor="default";this.te17.onselectstart=function(){return false};$(".canvas-toolbar button",a).bind("click",function(){var h=$(this).attr("name");if(h=="setProp"){}else{if(h=="loadModel"){if(b.loadProcess){for(var k in b.jp10){if(!confirm("加载流程图将会覆盖当前内容，是否要继续？")){return}break}b.setData(b.loadProcess.call(window))}}else{if(h=="loadTemplate"){if(b.loadTemplate){for(var k in b.jp10){if(!confirm("加载模板将会覆盖当前内容，是否要继续？")){return}break}b.setData(b.loadTemplate.call(window))}}else{if(h=="viewSoudce"){b.je153(b,b.getData())}else{if(h=="copy"){b.mv146()}else{if(h=="delete"){b.removeSelections()}else{if(h=="trace"){var m=b.jp10.deptActivity;var l=b.jp10.leadActivity;var j=b.qy157(m,l);b.qz158(j,"green")}else{if(h=="reload"){var i=b.getData();b.setData(i)}else{if(h=="vAlign"){b.alignFigures("v")}else{if(h=="hAlign"){b.alignFigures("h")}else{if(h=="undo"){b.undoManager.yn169()}else{if(h=="redo"){b.undoManager.kq168()}}}}}}}}}}}}}).bind("mouseover",function(){$(this).addClass("tool-item-over")}).bind("mouseout",function(){$(this).removeClass("tool-item-over")});this.fz155()};justep.graphics.ProcessWebCanvas.prototype.mv146=function(){var e=[];this.undoManager.zw160();for(var b=0;b<this.tz31.length;b++){var d=this.tz31[b];if(d.type!="connection"){var c=d.up57();var g=d.uc58();var a=d.modelData.xmlNode;if(a){var f=$.parseXml($(a).xml());a=f.firstChild}e.push(this.undoManager.uy163({xmlNode:a,LABEL:g,type:d.type,style:{shape:{x:c.x+30,y:c.y+20,w:c.w,h:c.h}}}))}}this.undoManager.sv161();if(e.length>0){this.clearSelection();for(var b=0;b<e.length;b++){this.qo138(e[b])}}};justep.graphics.ProcessWebCanvas.prototype.vv147=function(figure){var propContainer=$(".prop-area>.prop-list",this.te17.parentNode);$("select,input",propContainer).unbind();if(!figure){propContainer.html("");return}var htmlBuf=["<table cellspacing=0 cellpadding=0 style='font-size:10pt;'><tr>"];var self=this;var label=figure.uc58();var xmlNode=figure.modelData.xmlNode;var trueFalseOutput=[];htmlBuf.push('<td>标签：</td><td style="height:22px;"><input name="label"  value="'+label+'" class="prop-input" style="margin-right:15px;" ></td>');propContainer.html(htmlBuf.join(""));if(figure.type=="businessActivity"){var executeRule=$(">execute-rule",xmlNode);var executorRange=$(">executor-range",executeRule);var executeMode=$(">task-relation-value>item[relation='sExecuteMode']",executeRule);var advanceRule=$(">advance-rule",xmlNode);var customizedEnabled=advanceRule.attr("customized-enabled");var dRangeExpr=executorRange.attr("d-range-expr");var rangeExpr=executorRange.attr("range-expr");var executeModeName=executeMode.text();htmlBuf.push('<td>允许定制：</td><td><input name="customized-enabled" type="checkbox"  style="margin-right:15px" ></td>');htmlBuf.push('<td style="width:80px;">执行者模式：</td><td style="height:24px;"><select name="executeMode"  style="margin-right:15px ">');htmlBuf.push("<option value=\"'temPreempt'\">抢占</option>");htmlBuf.push("<option value=\"'temSequential'\" >顺序</option>");htmlBuf.push("<option value=\"'temSimultaneous'\" >同时</option>");htmlBuf.push("</select></td>");htmlBuf.push('<td style="width:60px;">执行者：</td><td style="height:22px;"><input name="executor-range" class="prop-input" readonly  ></td><td><input class="tool-item" type="button" value="选择..." name="rangeExprSelect" style="height:20px;padding:0;margin:0"></td>');htmlBuf.push("</tr></table>");propContainer.html(htmlBuf.join(""));$("input[name='rangeExprSelect']",propContainer).bind("click",function(){if(self.selectExecutor){var executorRange=$(">execute-rule>executor-range",xmlNode);var dRangeExpr=executorRange.attr("d-range-expr");dRangeExpr=eval("("+dRangeExpr+")");var rangeExpr=executorRange.attr("range-expr");self.selectExecutor.call(window,self,xmlNode,{items:dRangeExpr||[],expr:rangeExpr})}});this.co151("customized-enabled",customizedEnabled);this.co151("executeMode",executeModeName);this.co151("executor-range",this.vi152(dRangeExpr))}else{if(figure.type=="conditionBranch"){var data=[];var cons=figure.getBindingConnections();for(var i=0;i<cons.length;i++){var con=cons[i];var targetFigure=con.outPort.owner;if(targetFigure==figure){var inPutFigure=con.inPort.owner;var name=inPutFigure.wt89();data.push([name,inPutFigure.uc58()||name])}}trueFalseOutput=data;htmlBuf.push('<td>条件为真：</td><td><select name="true-output" style="margin-right:20px">');for(var i=0;i<data.length;i++){htmlBuf.push('<option value="'+data[i][0]+'" >'+data[i][1]+"</option>")}htmlBuf.push("</select></td>");htmlBuf.push('<td>条件为假：</td><td><select name="false-output" style="margin-right:20px">');for(var i=0;i<data.length;i++){htmlBuf.push('<option value="'+data[i][0]+'" >'+data[i][1]+"</option>")}htmlBuf.push("</select></td>");htmlBuf.push("</tr></table>");propContainer.html(htmlBuf.join(""));this.co151("true-output",$("true-output",xmlNode).attr("unit"));this.co151("false-output",$("false-output",xmlNode).attr("unit"))}else{htmlBuf.push("</tr></table>");propContainer.html(htmlBuf.join(""))}}if(figure.status=="finished"){$("select,input",propContainer).attr("disabled","true")}else{$("select,input",propContainer).bind("change",function(){var input=$(this);self.wq148(figure,input)})}};justep.graphics.ProcessWebCanvas.prototype.wq148=function(a,d){var g=a.modelData.xmlNode;var e=d.attr("name");var h=d.val();if(e=="label"){a.setText(h)}else{if(e=="executeMode"){this.setExecuteRuleProp(e,h)}else{if(e=="customized-enabled"){this.setExecuteRuleProp(e,d.attr("checked"))}else{if(e=="true-output"||e=="false-output"){var c=e=="true-output"?"false-output":"true-output";var b=e=="true-output"?"是":"否";$(e,g).remove();if(h){$(g).appendXml("<"+e+' xmlns="http://www.justep.com/model" name="x" unit="'+h+'"/>')}this.ct150(a,h,b);for(var f=0;f<trueFalseOutput.length;f++){if(trueFalseOutput[f][0]!=h){$(c,g).remove();$(g).appendXml("<"+c+' xmlns="http://www.justep.com/model" name="x" unit="'+trueFalseOutput[f][0]+'"/>');this.co151(c,trueFalseOutput[f][0]);this.ct150(a,trueFalseOutput[f][0],c=="true-output"?"是":"否");break}}}}}}};justep.graphics.ProcessWebCanvas.prototype.rl149=function(a){a=a.replace(/xmlns=""/gm,"");return a};justep.graphics.ProcessWebCanvas.prototype.ct150=function(a,d,e){var b=a.getBindingConnections();for(var c=0;c<b.length;c++){if(b[c].inPort.owner.wt89()==d){b[c].setText(e);break}}};justep.graphics.ProcessWebCanvas.prototype.setExecuteRuleProp=function(h,g,e){e=e||this.tz31[0].modelData.xmlNode;var c=$(">execute-rule",e);if(c.length==0&&(h=="executor-range"||h=="executeMode")){$(e).appendXml('<execute-rule xmlns="http://www.justep.com/model"></execute-rule>');c=$(">execute-rule",e)}if(h=="customized-enabled"){var b=$(">advance-rule",e);if(b.length==0){$(e).appendXml('<advance-rule xmlns="http://www.justep.com/model"></advance-rule>');b=$(">advance-rule",e)}b.attr("customized-enabled",g)}else{if(h=="executor-range"){var a=$(">executor-range",c);if(a.length==0){c.appendXml('<executor-range xmlns="http://www.justep.com/model"><kind>PSM</kind></executor-range>');a=$(">executor-range",c)}a.attr("range-expr",g.expr);a.attr("d-range-expr",JSON.stringify(g.items));this.co151("executor-range",this.vi152(JSON.stringify(g.items)))}else{if(h=="executeMode"){var f=$(">task-relation-value",c);if(f.length==0){c.appendXml('<task-relation-value xmlns="http://www.justep.com/model"></task-relation-value>');f=$(">task-relation-value",c)}var d=$(">item[relation='sExecuteMode']",f);if(d.length==0){f.appendXml('<item xmlns="http://www.justep.com/model" relation="sExecuteMode">'+g+"</item>  ")}else{d.text(g)}}}}};justep.graphics.ProcessWebCanvas.prototype.co151=function(c,b){var a=$(".prop-area>.prop-list *[name='"+c+"']",this.te17.parentNode);if(c=="customized-enabled"){if(b=="true"){a.attr("checked","true")}else{a.removeAttr("checked")}}else{$(".prop-area>.prop-list *[name='"+c+"']",this.te17.parentNode).val(b)}};justep.graphics.ProcessWebCanvas.prototype.vi152=function(dRangeExpr){if(dRangeExpr){var names=[];dRangeExpr=eval("("+dRangeExpr+")");for(var i=0;i<dRangeExpr.length;i++){var fname=dRangeExpr[i].fname||"";var idx=fname.lastIndexOf("/");if(idx!=-1){fname=fname.substring(idx+1)}names.push(fname)}return names.join(",")}return""};justep.graphics.ProcessWebCanvas.prototype.je153=function(a,d){if(this.propDialog){return}if(this.tz31.length<0){alert("请选择需要设置的图形!");return}var c=this.tz31[0];var b=["<div style='position:absolute;border:1px solid #baceeb;background:white;width:650px;'><div class='toolbox-title' style=' height:22px;line-height:22px;padding-left:5px; '>流程源码</div>"];b.push("<div class='content' style='height:400px;'><textarea style='border:0;width:646px;height:398px'></textarea></div>");b.push("<div class='propdlg-footer' style='border:1px solid #baceeb;'> <button style='width:60px;float:right;' name='cancel'>关闭</button></div></div>");this.propDialog=$(b.join("")).appendTo(document.body).css({top:(document.body.clientHeight/2-260)+"px",left:(document.body.clientWidth/2-400)+"px"});$("textarea",this.propDialog).val(d);$(".propdlg-footer button",this.propDialog).bind("click",function(){var e=$(this).name;if(e=="ok"){}a.zi154()})};justep.graphics.ProcessWebCanvas.prototype.zi154=function(){if(this.propDialog){$(".propdlg-footer button",this.propDialog).unbind();this.propDialog.remove().empty();this.propDialog=null}};justep.graphics.ProcessWebCanvas.prototype.fz155=function(){var a=this;setTimeout(function(){var c=180;var d=70;var f=$(".canvas-toolbar").outerHeight();var g=$(a.te17.parentNode);var b=g.width()-c;var e=g.height();$(".mydesigner",g).width(b+3).height(e-f-d-3);$(".prop-area",g).css({height:d,"border-top":"0",width:g.width()-2});$(".toolbox",g).css({left:b+4,width:c-6,height:e-f-2-d-1,top:f})},200)};justep.graphics.ProcessWebCanvas.prototype.md156=function(h,a){if(!h){return{}}var a=a||{};var n=a.shapeStyle||{};var m={verstion:a.version,processMainData:{LABEL:""}};var k=new Date().getTime();var o=h.childNodes;var v;for(var s=0;s<o.length;s++){var b=o[s].tagName;if(b=="model"){var u=o[s].childNodes;for(var r=0;r<u.length;r++){if(u[r].tagName=="process"||u[r].tagName=="template"){v=u[r];break}}break}else{if(b=="process"||b=="template"){v=o[s];break}}}if(!v){return}this.root=v;var t=this.nameMap;var g=v.getAttribute("start");var e=v.getAttribute("end");this.startName=g;var o=v.childNodes;var w=m.processMainData;var c=[],f=[];for(var s=0,q=o.length;s<q;s++){var p=o[s];var d=t[p.tagName];if(d){if(d=="place"){if(name==g){d="start"}else{if(name==e){d="end"}else{d="xor"}}}var x=p.getAttribute("name");if(d=="connection"){x=p.getAttribute("from")+"|"+p.getAttribute("to");w[x]={sourceNode:p.getAttribute("from"),targetNode:p.getAttribute("to"),xmlNode:p,name:x,src:x,type:d,LABEL:$(">label",p).text(),style:n[x]}}else{w[x]={xmlNode:p,name:x,src:x,type:d,LABEL:$(">label",p).text(),style:n[x]}}$(">output,>true-output,>false-output,>input",p).each(function(j){var C=$(this);var A=C.attr("unit");var y=$(">label",C).text();var B,i,z;if(C[0].tagName=="input"){B=A+"|"+x;i=A;z=x}else{B=x+"|"+A;i=x;z=A}var l=w[B];if(!l){w[B]={type:"connection",sourceNode:i,targetNode:z,LABEL:y,style:n[B]}}else{l.LABEL=l.LABEL||y}})}}return m};justep.graphics.ProcessWebCanvas.prototype.setData=function(data){if(!data){return}var xml=data[0];var shape=data[1];shape=typeof shape=="string"?eval("("+shape+")"):shape;var xmlDoc=$.parseXml(xml);var t1=new Date().getTime();var modelData=this.md156(xmlDoc,shape);this.loadData(modelData);var currents=data[2]||[];var finishedActivities=data[3]||[];var currentColor="#0080FF";var finishColor="green";if(finishedActivities.length>0){for(var i=0,l=finishedActivities.length;i<l;i++){var act=finishedActivities[i];if(act[2]){continue}var from=this.jp10[act[0]];var to=this.jp10[act[1]];var trace=this.qy157(from,to);for(var j=0,ll=trace.length;j<ll;j++){trace[j].status="finished";this.qz158(trace[j],finishColor)}}}if(currents.length>0){for(var p in this.jp10){var figure=this.jp10[p];for(var i=0;i<currents.length;i++){if(figure.wt89()==currents[i]){figure.status="finished";this.qz158(figure,currentColor)}}}}if((finishedActivities.length>0||currents.length>0)){if(this.startName){var figure=this.vs117(this.startName);if(figure){figure.status="finished";this.qz158(figure,finishColor);var cons=figure.getBindingConnections();for(var i=0;i<cons.length;i++){if(cons[i].outPort.owner==figure){cons[i].status="finished";this.qz158(cons[i],finishColor)}}}}$("button[name='loadModel'],button[name='loadTemplate']",this.te17.parentNode).removeClass("tool-item-over").attr("disabled","true")}else{$("button[name='loadModel'],button[name='loadTemplate']",this.te17.parentNode).removeAttr("disabled")}this.fz155()};justep.graphics.ProcessWebCanvas.prototype.qy157=function(h,g,c,b,f){if(h==g||h==f||!h||!g){return}if(!c){c=[];b=[false];f=h;c.push(h)}var a=h.getBindingConnections();for(var d=0;d<a.length;d++){if(a[d].outPort.owner==h){var e=a[d].inPort.owner;if(e==g){b[0]=true;c.push(g);c.push(a[d]);break}else{this.qy157(e,g,c,b,f||h);if(b[0]){c.push(e);c.push(a[d])}}}if(b[0]){break}}return c},justep.graphics.ProcessWebCanvas.prototype.qz158=function(a,b){var a=a.xd86();a.uc54(b);a.ih53({color:b})};justep.graphics.ProcessWebCanvas.prototype.getData=function(){return[this.xa159(),this.getFigureStyles()]};justep.graphics.ProcessWebCanvas.prototype.initToolbox=function(e){var b=this.te17.parentNode;$(".toolbox-items>li>a",b).unbind();$(".toolbox-items>li[name='dynItem']",b).remove().empty();var f;if(typeof e=="string"){var n=$.parseXml(e);var a=n.childNodes;for(var d=0;d<a.length;d++){if(a[d].tagName=="items"){f=a[d];break}}}else{f=e}if(f){var g=[];var h=f.childNodes;for(var d=0;d<h.length;d++){var m=h[d];var c=m.getAttribute("activity")||"";var l=m.getAttribute("tag");var j=m.getAttribute("label")||c;if(l=="activity"){l="business-activity"}if("true"==m.getAttribute("isEnd")){l="end"}g.push('<li name="dynItem"><a href="javascript:void(0);" label="'+j+'"  onfocus="this.blur();" class="'+l+'" src='+c+' title="'+c+'">'+j+"</a></li>")}$(".toolbox-items li:eq(1)",b).after(g.join(""));var k=this;$(".toolbox-items>li>a",b).each(function(i){var o=$(this);o.bind("mousedown",function(r){var q=o[0].className;if(q=="cancel-selected"){k.selectProcessItemType()}else{var p=k.nameMap[q];if(p){k.selectProcessItemType(p,false,{src:o.attr("src"),LABEL:o.attr("label")||"",type:p})}}})})}};justep.graphics.ProcessWebCanvas.prototype.xa159=function(){var h="zh_CN";var f=[];var c;var m;for(var d in this.jp10){var k=this.jp10[d];if(k.ly16&&k.type!="connection"){var q=k.modelData;var n=q.xmlNode;var a=k.getBindingConnections();var o=false;$("label",n).text(k.uc58());if(k.type=="start"){c=q.name}if(n.tagName=="place"){for(var g=0;g<a.length;g+=1){if(a[g].inPort.owner==k){o=true;break}}if(o==false){}f.push("  "+$(n).xml()+"\n");continue}if(n){$("input,output",n).remove()}var j=[];for(var g=0;g<a.length;g+=1){var b=a[g];if(b.outPort.owner==k){if(n.tagName!="if-else-activity"){$(n).appendXml('  <output xmlns="http://www.justep.com/model" name="x" unit="'+b.inPort.owner.wt89()+'"/>\n')}}else{o=true;$(n).appendXml('  <input xmlns="http://www.justep.com/model" name="x" unit="'+b.outPort.owner.wt89()+'"/>\n')}}if(o==false){m=d}f.push("  "+$(n).xml()+"\n")}else{var e=k.outPort.owner;var l=k.inPort.owner;if(e.modelData.tagName=="place"&&l.modelData.tagName=="place"){f.push('<arc name="arc'+this.us116("arc")+'" from="'+e.wt89()+'" to="'+l.wt89()+'"/>\n')}}}if(!c&&this.root){c=this.root.getAttribute("start")}if(c){c='start="'+c+'"'}else{c=""}for(var g=0;g<f.length;g+=1){f[g]=this.rl149(f[g])}f.splice(0,0,'<?xml version="1.0" encoding="UTF-8"?>\n<process '+c+">\n");f.push("</process>\n");return f.join("")};justep.graphics.ProcessWebCanvas.prototype.qo138=function(a,b){if(!a.bt94()){a.bb93();this.tz31.push(a);if(!b){this.nt140("add",a)}this.vv147(a)}};justep.graphics.ProcessWebCanvas.prototype.clearSelection=function(){var b=$(".prop-area>.prop-list",this.te17.parentNode);$("select,input",b).each(function(){$(this)[0].blur()});for(var c=0,a=this.tz31.length;c<a;c++){if(this.tz31[c]&&this.tz31[c].clearSelection){this.tz31[c].clearSelection()}}this.tz31=[];this.vv147(null)};justep.graphics.UndoRedoManager={designer:null,undoList:[],redoList:[],actions:[],isBatch:false,ye128:function(){this.undoList=[];this.redoList=[]},zw160:function(){this.isBatch=true;this.actions=[]},sv161:function(){this.isBatch=false;this.redoList=[];this.undoList.push(this.actions);this.cs167()},gd162:function(a){a.designer=this.designer;if(this.isBatch){this.actions.push(a)}else{this.redoList=[];this.undoList.push([a])}this.cs167()},uy163:function(a){var b=new justep.graphics.undoable.NewAction(a);this.gd162(b);return b.execute()},ao164:function(b){if(b.length==0){return}var a=new justep.graphics.undoable.RemoveAction(b);this.gd162(a);return a.execute()},jr165:function(b,a){var c=new justep.graphics.undoable.ChangeShapeAction(b,a);this.gd162(c);return c.execute()},uz166:function(c,b,a){var d=new justep.graphics.undoable.ChangePortAction(c,b,a);this.gd162(d);return d.execute()},cs167:function(){if(this.redoList.length==0){$("button[name='redo']",this.designer.te17.parentNode).removeClass("tool-item-over").attr("disabled","true")}else{$("button[name='redo']",this.designer.te17.parentNode).removeAttr("disabled")}if(this.undoList.length==0){$("button[name='undo']",this.designer.te17.parentNode).removeClass("tool-item-over").attr("disabled","true")}else{$("button[name='undo']",this.designer.te17.parentNode).removeAttr("disabled")}},kq168:function(){if(this.redoList.length==0){return}var b=this.redoList[this.redoList.length-1];if(b){for(var a=0;a<b.length;a++){b[a].execute()}this.redoList.splice(this.redoList.length-1,1);this.undoList.push(b)}this.designer.vg134();this.cs167()},yn169:function(){if(this.undoList.length==0){return}var b=this.undoList[this.undoList.length-1];if(b){for(var a=0;a<b.length;a++){b[a].yn169()}this.undoList.splice(this.undoList.length-1,1);this.redoList.push(b)}this.designer.vg134();this.cs167()}};justep.graphics.undoable={};justep.graphics.undoable.NewAction=function(a){this.modelData=$.extend({},a)};justep.graphics.undoable.NewAction.prototype={execute:function(){var a=this.designer.dk127(this.modelData);this.id=a.id;if(a.type=="connection"){if(a.vn56().length==2){var b=a.vn56();if(b[0].x!=b[1].x&&b[0].y!=b[1].y){a.inPort.gj84(a)}}}return a},yn169:function(){this.designer.oq139(this.figure);var b=this.id;var a=this.designer.jp10[b];this.designer.jp10[b]=null;delete this.designer.jp10[b];a.do63()}};justep.graphics.undoable.RemoveAction=function(a){this.ids=$.isArray(a)?a:[a];this.processRects=[];this.as25=[]};justep.graphics.undoable.RemoveAction.prototype={execute:function(){var f=[];for(var d=0;d<this.ids.length;d++){var g=this.ids[d];var a=this.designer.jp10[g];if(!a){continue}if(a.type!="connection"){f.push(a)}var b=a.getBindingConnections?a.getBindingConnections():[a];for(var c=0;c<b.length;c++){if(this.isInit!=false){var e=$.extend({},b[c].modelData);e.style=this.designer.cc144(b[c]);this.as25.push(e)}this.designer.jp10[b[c].id]=null;delete this.designer.jp10[b[c].id];b[c].do63()}}for(var d=0;d<f.length;d++){var a=f[d];if(this.isInit!=false){var e=$.extend({},a.modelData);e.style=this.designer.cc144(a);this.processRects.push(e)}this.designer.jp10[a.id]=null;delete this.designer.jp10[a.id];a.do63()}this.isInit=false},yn169:function(){if(this.processRects){for(var a=0;a<this.processRects.length;a++){this.designer.dk127(this.processRects[a])}}if(this.as25){for(var a=0;a<this.as25.length;a++){this.designer.dk127(this.as25[a])}}}};justep.graphics.undoable.ChangePortAction=function(c,b,a){this.id=c;this.newPort=b;this.portType=a};justep.graphics.undoable.ChangePortAction.prototype={execute:function(){var b=this.designer.jp10[this.id];if(!this.oldPort){var c=b[this.portType];this.oldPortCfg={ownerId:c.owner.id,direction:c.direction}}if(!this.newPortCfg){b.sm102(this.newPort,this.portType,true);this.newPortCfg={ownerId:this.newPort.owner.id,direction:this.newPort.direction}}else{var a=this.designer.jp10[this.newPortCfg.ownerId].ca92(this.portType,this.newPortCfg.direction);b.sm102(a,this.portType,true)}},yn169:function(){var a=this.designer.jp10[this.id];var b=this.designer.jp10[this.oldPortCfg.ownerId].ca92(this.portType,this.oldPortCfg.direction);a.sm102(b,this.portType,true)}};justep.graphics.undoable.ChangeShapeAction=function(b,a){this.id=b;this.newShape=$.extend(true,$.isArray(a)?[]:{},a)};justep.graphics.undoable.ChangeShapeAction.prototype={execute:function(){var a=this.designer.jp10[this.id];if(!this.oldShape){this.oldShape=$.extend(true,$.isArray(this.newShape)?[]:{},a.vn56())}a.xt52($.extend(true,$.isArray(this.newShape)?[]:{},this.newShape))},yn169:function(){this.designer.jp10[this.id].xt52($.extend(true,$.isArray(this.newShape)?[]:{},this.oldShape))}};