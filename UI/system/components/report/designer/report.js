justep.design.Report=function(a){if(a.data&&a.data.firstChild){this.isExcel=a.data.firstChild.getAttribute("src")}selctionChangeCaller=null;selectionClearCaller=null;justep.design.Report.superclass.constructor.call(this,a)};justep.extend(justep.design.Report,justep.design.CellLayout,{paintContent:function(d){var h=d.getAttribute("src");this.isExcel=h!=null&&h!="";if(this.isExcel){this.createElement("<div isViewPartContent='false'   class='xui-report' id='"+this.id+"'></div>",d);var g=d.childNodes;var b=g.length;for(var c=0;c<b;c++){var e=g[c];if(e.nodeType==1){this.canvas.parseXml(e,this.element)}else{if(e.nodeType==3||e.nodeType==4){var f=document.createTextNode(e.nodeValue||"");this.element.appendChild(f)}}}if(LayoutUtils.isCellLayout(this.getParentComponent())){this.setProperty("class","xui-autofill",false,true)}}else{justep.design.Report.superclass.paintContent.call(this,d);this.hasHead=true;var a=this.ew20.className;this.ew20.className=a.replace("nohead","hashead")}},setProperty:function(d,a,c,b){if(this.isExcel){justep.design.CellLayout.superclass.setProperty.call(this,d,a,c,b)}else{justep.design.Report.superclass.setProperty.call(this,d,a,c,b)}},addChild:function(c,b,a){if(this.isExcel){justep.design.CellLayout.superclass.addChild.call(this,c,b,a)}else{justep.design.Report.superclass.addChild.call(this,c,b,a)}},removeChild:function(a){if(this.isExcel){justep.design.CellLayout.superclass.removeChild.call(this,a)}else{justep.design.Report.superclass.removeChild.call(this,a)}},insertValidate:function(c,a){if(!this.excel&&c.indexOf(":")>0){var b=c.split(":");if(b[0]=="reportElement"){return"true"}}return"false"},getCellFormat:function(){var a=this.fw9.getAttribute("format");if(a==null){a=""}return a},setCellFormat:function(a){this.fw9.setAttribute("format",a.format);this.qw30()},addChildElement:function(a){var b=this.canvas.insertPos.parentElement;b.innerHTML=a.data;this.qw30()},setCellProperty:function(g){var e=g.propName;var f=g.propValue;var b=this.kh73(e);if(b){var a=b.getAttribute("_cellAttr");if(a==null){a="{}"}var d=JSON.parse(a);if(f==""){d[e]=undefined}else{d[e]=this.br77(f)}b.setAttribute("_cellAttr",JSON.stringify(d));if(e=="display-type"){b.setAttribute("format","")}canvas.println("updateLayoutContent{ - 测试版本保留输出")}var c=this;setTimeout(function(){canvas.println("      }");c.qw30()},300)},kq72:function(d){var b=this.kh73(d);var a=b.getAttribute("_cellAttr");if(a!=null){var c=JSON.parse(a);return c[d]}return null},kh73:function(d){var c=this.fw9;if("auto-width|auto-height|override-print".indexOf(d)!=-1){c=this.ew20.rows[0].cells[0]}else{if("v-visible|table-header|table-footer|page-break|keep-together".indexOf(d)!=-1){c=c.parentNode.cells[0]}else{if("h-visible".indexOf(d)!=-1){var a=this.vn40(c);c=this.ym43(a.x,a.w-2)}}}return c},in74:function(d){var e={};var f=["auto-width","auto-height","override-print","v-visible","table-header","table-footer","page-break","keep-together","h-visible","display-type","barcode-type","barcode-config","select","selecth","colspan","rowspan","is-master-dataset","record-per-page","record-per-page","colcount","group","grouph","group-break","image","image-size","object","h-group","v-group","default-value"];for(var b=0;b<f.length;b++){var a=f[b];var c=this.kq72(a);if(c!=null){e[a]=c}}return e},buildOtherAttribute:function(b,a){var d=b.getAttribute("_cellAttr");if(d!=null){var c=this.br77(d);c=c.replace(/&apos;/g,"__apos__");a+=" _cellAttr='"+c+"'"}d=b.getAttribute("format");if(d!=null){a+=' format="'+d.replace(/&quot;/g,"__quot__")+'"'}return a},createSelectionUnit:function(d){if(!d){return}if(!this.um48(d)){this.an13=d;this.zy17.push(new SelectionUnit(this).tz22(this.vn40(d)));this.ps33(d);var h=d.getAttribute("_cellAttr");var i=this.ew20.rows[0].cells[0].getAttribute("_cellAttr");var c=d.parentNode.cells[0].getAttribute("_cellAttr");var a=this.vn40(d);var f=this.ym43(a.x,a.w-2).getAttribute("_cellAttr");var g="";if(h){g+=h.replace("{","").replace("}","")+","}if(i){g+=i.replace("{","").replace("}","")+","}if(c){g+=c.replace("{","").replace("}","")+","}if(f){g+=f.replace("{","").replace("}","")+","}if(g){g=g.substring(0,g.length-1)}if(selctionChangeCaller){clearTimeout(selectionClearCaller);selectionClearCaller=null;clearTimeout(selctionChangeCaller);selctionChangeCaller=null}var e=this;selctionChangeCaller=setTimeout(function(){if(e.canvas){e.canvas.dispatchEvent({event:"cellLayoutSelectionChanged",id:e.control,style:d.style.cssText,value:d.innerHTML,cellProperty:g})}},400)}},rj49:function(){justep.design.Report.superclass.rj49.call(this);if(selectionClearCaller){clearTimeout(selectionClearCaller);selectionClearCaller=null}var a=this;selectionClearCaller=setTimeout(function(){if(a.canvas){a.canvas.dispatchEvent({event:"cellLayoutClearSeleection",id:a.control})}},400)},importFromExcel:function(){var a=this.ew20.className;this.ew20.className=a.replace("nohead","hashead");this.hn76();this.xj75()},init:function(a,b){justep.design.Report.superclass.init.call(this,a,b);this.xj75();this.hn76()},insertRow:function(){justep.design.Report.superclass.insertRow.call(this);this.xj75()},deleteRow:function(){justep.design.Report.superclass.deleteRow.call(this);this.xj75()},insertCol:function(){justep.design.Report.superclass.insertCol.call(this);this.hn76()},deleteCol:function(){justep.design.Report.superclass.deleteCol.call(this);this.hn76()},xj75:function(){var b=this.ew20.rows;for(var c=1;c<b.length;c++){var a=b[c].cells[0];a.innerHTML=c}},hn76:function(){var b=this.ew20.rows[0].cells;for(var a=1;a<b.length;a++){var d="";if(a>26){d=String.fromCharCode((Math.floor((a-1)/26)-1)%26+65)}var c=String.fromCharCode((a-1)%26+65);b[a].innerHTML=d+c}},br77:function(a){a=a.replace(/&amp;/g,"__amp__");a=a.replace(/&lt;/g,"__lt__");a=a.replace(/&gt;/g,"__gt__");a=a.replace(/&apos;/g,"__apos__");a=a.replace(/&quot;/g,"__quot__");a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/'/g,"&apos;");a=a.replace(/"/g,"&quot;");a=a.replace(/__amp__/g,"&amp;");a=a.replace(/__lt__/g,"&lt;");a=a.replace(/__gt__/g,"&gt;");a=a.replace(/__apos__/g,"&apos;");a=a.replace(/__quot__/g,"&quot;");return a}});